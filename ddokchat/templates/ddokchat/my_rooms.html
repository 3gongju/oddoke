{% extends "base.html" %}
{% load humanize %}

{% block body %}
<h2 class="text-xl font-bold mb-6">ë‚´ ì±„íŒ…ë°© ëª©ë¡</h2>

<div class="space-y-4">
  {% for room in rooms %}
    {% with post=room.post %}
      <div class="p-4 border rounded-lg">
        <p class="text-sm text-gray-500">ê±°ë˜ê¸€: {{ post.title }}</p>

        {% if me == room.buyer %}
          <p>íŒë§¤ì: {{ room.seller.username }}</p>
        {% else %}
          <p>êµ¬ë§¤ì: {{ room.buyer.username }}</p>
        {% endif %}

        <!-- ë§ˆì§€ë§‰ ë©”ì‹œì§€ ìš”ì•½ -->
        <p class="text-sm text-gray-700 mt-1">
            ğŸ“¨
            {% if room.last_message %}
                <strong>{{ room.last_message.sender.username }}</strong>: {{ room.last_message.content|truncatechars:30 }}
                {% if room.unread_count %}
                <span class="ml-2 text-xs text-red-500 font-semibold">
                    ({{ room.unread_count }})
                </span>
                {% endif %}
                <span class="text-xs text-gray-400 ml-2">
                ({{ room.last_message.timestamp|timesince }} ì „)
                </span>
            {% else %}
                ì•„ì§ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.
            {% endif %}
        </p>

        <a href="{% url 'ddokchat:chat_room' room_id=room.id %}"
           class="inline-block mt-2 px-4 py-2 bg-black text-white rounded hover:bg-gray-800 text-sm">
          ì±„íŒ…ë°© ì…ì¥
        </a>
      </div>
    {% endwith %}
  {% empty %}
    <p class="text-gray-400">ì°¸ì—¬ ì¤‘ì¸ ì±„íŒ…ë°©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
  {% endfor %}
</div>
{% endblock %}
