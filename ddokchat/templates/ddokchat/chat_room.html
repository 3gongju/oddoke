{% extends "base.html" %}
{% load static %}

{% block body %}
<div class="max-w-4xl mx-auto px-4 py-0 bg-gray-50 min-h-screen">
  <div class="flex flex-col h-screen bg-gray-100 rounded-xl overflow-hidden shadow-sm">
    
    <!-- 채팅방 헤더 -->
    {% include 'ddokchat/components/chat/_header.html' %}

    <!-- 채팅 메시지 영역 -->
    {% include 'ddokchat/components/chat/_messages.html' %}

    <!-- 메시지 입력 영역 -->
    {% include 'ddokchat/components/chat/_input_area.html' %}
    
  </div>
</div>

<!-- 모달들 -->
{% include 'ddokchat/components/modals/_fraud_check.html' %}
{% include 'ddokchat/components/modals/_trade_complete.html' %}

<!-- 리뷰 모달 -->
{% if current_user == room.buyer and not has_already_reviewed %}
  {% include 'ddokchat/components/modals/_review.html' %}
{% endif %}
<!-- CSS 파일들 로드 -->
<link rel="stylesheet" href="{% static 'css/ddokchat/chat_room.css' %}">
<link rel="stylesheet" href="{% static 'css/ddokchat/animations.css' %}">
<link rel="stylesheet" href="{% static 'css/ddokchat/modals.css' %}">
<link rel="stylesheet" href="{% static 'css/ddokchat/message_bubbles.css' %}">
<script>
  // 전역 변수 설정
  window.roomId = "{{ room.id }}";
  window.currentUser = "{{ current_user.username }}";
  window.currentUserId = "{{ current_user.id }}";
  window.isTradeCompleted = "{{ room.is_fully_completed }}" === "True";
  window.hasAlreadyReviewed = {{ has_already_reviewed|yesno:"true,false" }};
  window.isFullyCompleted = {{ room.is_fully_completed|yesno:"true,false" }};
  window.roomBuyer = "{{ room.buyer.username }}";
</script>
<script type="module" src="{% static 'js/ddokchat/chat_room.js' %}"></script>
{% endblock %}