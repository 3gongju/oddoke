{% extends "base.html" %}
{% load static %}

{% block body %}
<!-- 전체 화면 높이 사용 -->
<div class="h-screen flex flex-col bg-gray-50">
  
  <!-- 채팅방 헤더 (고정 높이) -->
  {% include 'ddokchat/components/chat/_header.html' %}

  <!-- 메시지 영역 (가변 높이) -->
  <div class="flex-1 overflow-hidden">
    {% include 'ddokchat/components/chat/_messages.html' %}
  </div>

  <!-- 메시지 입력 영역 (고정 높이) -->
  {% include 'ddokchat/components/chat/_input_area.html' %}
  
</div>

<!-- 모달들 -->
{% include 'ddokchat/components/modals/_fraud_check.html' %}
{% include 'ddokchat/components/modals/_trade_complete.html' %}

<!-- 리뷰 모달 -->
{% if current_user == room.buyer and not has_already_reviewed %}
  {% include 'ddokchat/components/modals/_review.html' %}
{% endif %}

<!-- CSS 파일들 로드 -->
<link rel="stylesheet" href="{% static 'css/ddokchat/chat_room.css' %}">
<link rel="stylesheet" href="{% static 'css/ddokchat/animations.css' %}">
<link rel="stylesheet" href="{% static 'css/ddokchat/modals.css' %}">
<link rel="stylesheet" href="{% static 'css/ddokchat/message_bubbles.css' %}">

<!-- 채팅방 전용 스타일 - chat_room.html의 style 태그 내용 -->
<style>
  /* 기존 스타일들 */
  body {
    overflow: hidden !important;
  }
  
  #faqButton, #faqModal {
    display: none !important;
  }
  
  html, body {
    height: 100%;
    overflow-x: hidden;
  }
  
  /* 모든 하단 여백 강제 제거 */
  body > *:last-child {
    display: none !important;
  }
  
  .h-32, .h-48 {
    display: none !important;
  }
  
  body {
    margin: 0 !important;
    padding: 0 !important;
    overflow: hidden !important;
  }
  
  /* 🔥 채팅 컨테이너 너비 제한 및 중앙 정렬 */
  .h-screen {
    height: 100vh !important;
    position: fixed !important;
    top: 0 !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    width: 100vw !important;
    max-width: 800px !important; /* PC에서 최대 너비 제한 */
  }
  
  /* 🔥 반응형 네비게이션 및 헤더 위치 조정 */
  @media (max-width: 767px) {
    /* 모바일: 네비바 숨김 */
    nav {
      display: none !important;
    }
    
    /* 채팅 헤더 위치 조정 */
    .h-screen {
      top: 0 !important;
      width: 100vw !important;
      max-width: none !important; /* 모바일에서는 너비 제한 없음 */
    }
    
    #chat-log {
      height: calc(100vh - 110px) !important;
      padding-bottom: 2.5rem !important; /* 하단 여백 증가 */
    }
  }
  
  @media (min-width: 768px) {
    /* PC: 네비바 유지 */
    .h-screen {
      top: 64px !important; /* 네비바 높이만큼 아래로 */
      height: calc(100vh - 64px) !important; /* 네비바 높이 제외 */
    }
    
    #chat-log {
      height: calc(100vh - 174px) !important;
      padding-bottom: 2.5rem !important; /* 하단 여백 증가 */
    }
    
    /* PC에서 좌우 여백 추가 */
    #messageInputArea {
      padding-left: 1rem !important;
      padding-right: 1rem !important;
    }
  }
  
  /* 입력창 상단 여백 제거 */
  #messageInputArea {
    padding-bottom: 0.75rem !important; /* pb-3만 유지 */
  }
</style>

<script>
  // 전역 변수 설정
  window.roomId = "{{ room.id }}";
  window.currentUser = "{{ current_user.username }}";
  window.currentUserId = "{{ current_user.id }}";
  window.isTradeCompleted = "{{ room.is_fully_completed }}" === "True";
  window.hasAlreadyReviewed = {{ has_already_reviewed|yesno:"true,false" }};
  window.isFullyCompleted = {{ room.is_fully_completed|yesno:"true,false" }};
  window.roomBuyer = "{{ room.buyer.username }}";
</script>
<script type="module" src="{% static 'js/ddokchat/chat_room.js' %}"></script>
{% endblock %}