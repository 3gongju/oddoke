{% extends "base.html" %}
{% load static %}

{% block body %}
<!-- ì „ì²´ í™”ë©´ ë†’ì´ ì‚¬ìš© -->
<div class="h-screen flex flex-col bg-gray-50">
  
  <!-- ì±„íŒ…ë°© í—¤ë” (ê³ ì • ë†’ì´) -->
  {% include 'ddokchat/components/chat/_header.html' %}

  <!-- ë©”ì‹œì§€ ì˜ì—­ (ê°€ë³€ ë†’ì´) -->
  <div class="flex-1 overflow-hidden">
    {% include 'ddokchat/components/chat/_messages.html' %}
  </div>

  <!-- ë©”ì‹œì§€ ì…ë ¥ ì˜ì—­ (ê³ ì • ë†’ì´) -->
  {% include 'ddokchat/components/chat/_input_area.html' %}
  
</div>

<!-- ëª¨ë‹¬ë“¤ -->
{% include 'ddokchat/components/modals/_fraud_check.html' %}
{% include 'ddokchat/components/modals/_trade_complete.html' %}

<!-- ë¦¬ë·° ëª¨ë‹¬ -->
{% if current_user == room.buyer and not has_already_reviewed %}
  {% include 'ddokchat/components/modals/_review.html' %}
{% endif %}

<!-- CSS íŒŒì¼ë“¤ ë¡œë“œ -->
<link rel="stylesheet" href="{% static 'css/ddokchat/chat_room.css' %}">
<link rel="stylesheet" href="{% static 'css/ddokchat/animations.css' %}">
<link rel="stylesheet" href="{% static 'css/ddokchat/modals.css' %}">
<link rel="stylesheet" href="{% static 'css/ddokchat/message_bubbles.css' %}">

<!-- ì±„íŒ…ë°© ì „ìš© ìŠ¤íƒ€ì¼ - chat_room.htmlì˜ style íƒœê·¸ ë‚´ìš© -->
<style>
  /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ë“¤ */
  body {
    overflow: hidden !important;
  }
  
  #faqButton, #faqModal {
    display: none !important;
  }
  
  html, body {
    height: 100%;
    overflow-x: hidden;
  }
  
  /* ëª¨ë“  í•˜ë‹¨ ì—¬ë°± ê°•ì œ ì œê±° */
  body > *:last-child {
    display: none !important;
  }
  
  .h-32, .h-48 {
    display: none !important;
  }
  
  body {
    margin: 0 !important;
    padding: 0 !important;
    overflow: hidden !important;
  }
  
  /* ğŸ”¥ ì±„íŒ… ì»¨í…Œì´ë„ˆ ë„ˆë¹„ ì œí•œ ë° ì¤‘ì•™ ì •ë ¬ */
  .h-screen {
    height: 100vh !important;
    position: fixed !important;
    top: 0 !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    width: 100vw !important;
    max-width: 800px !important; /* PCì—ì„œ ìµœëŒ€ ë„ˆë¹„ ì œí•œ */
  }
  
  /* ğŸ”¥ ë°˜ì‘í˜• ë„¤ë¹„ê²Œì´ì…˜ ë° í—¤ë” ìœ„ì¹˜ ì¡°ì • */
  @media (max-width: 767px) {
    /* ëª¨ë°”ì¼: ë„¤ë¹„ë°” ìˆ¨ê¹€ */
    nav {
      display: none !important;
    }
    
    /* ì±„íŒ… í—¤ë” ìœ„ì¹˜ ì¡°ì • */
    .h-screen {
      top: 0 !important;
      width: 100vw !important;
      max-width: none !important; /* ëª¨ë°”ì¼ì—ì„œëŠ” ë„ˆë¹„ ì œí•œ ì—†ìŒ */
    }
    
    #chat-log {
      height: calc(100vh - 110px) !important;
      padding-bottom: 2.5rem !important; /* í•˜ë‹¨ ì—¬ë°± ì¦ê°€ */
    }
  }
  
  @media (min-width: 768px) {
    /* PC: ë„¤ë¹„ë°” ìœ ì§€ */
    .h-screen {
      top: 64px !important; /* ë„¤ë¹„ë°” ë†’ì´ë§Œí¼ ì•„ë˜ë¡œ */
      height: calc(100vh - 64px) !important; /* ë„¤ë¹„ë°” ë†’ì´ ì œì™¸ */
    }
    
    #chat-log {
      height: calc(100vh - 174px) !important;
      padding-bottom: 2.5rem !important; /* í•˜ë‹¨ ì—¬ë°± ì¦ê°€ */
    }
    
    /* PCì—ì„œ ì¢Œìš° ì—¬ë°± ì¶”ê°€ */
    #messageInputArea {
      padding-left: 1rem !important;
      padding-right: 1rem !important;
    }
  }
  
  /* ì…ë ¥ì°½ ìƒë‹¨ ì—¬ë°± ì œê±° */
  #messageInputArea {
    padding-bottom: 0.75rem !important; /* pb-3ë§Œ ìœ ì§€ */
  }
</style>

<script>
  // ì „ì—­ ë³€ìˆ˜ ì„¤ì •
  window.roomId = "{{ room.id }}";
  window.currentUser = "{{ current_user.username }}";
  window.currentUserId = "{{ current_user.id }}";
  window.isTradeCompleted = "{{ room.is_fully_completed }}" === "True";
  window.hasAlreadyReviewed = {{ has_already_reviewed|yesno:"true,false" }};
  window.isFullyCompleted = {{ room.is_fully_completed|yesno:"true,false" }};
  window.roomBuyer = "{{ room.buyer.username }}";
</script>
<script type="module" src="{% static 'js/ddokchat/chat_room.js' %}"></script>
{% endblock %}