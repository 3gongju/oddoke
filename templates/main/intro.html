{# templates/main/intro.html #}
<!DOCTYPE html>
{% load static %}
<html lang="ko" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page_title }} - 어덕해</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 커스텀 스타일 -->
    <style>
        /* 스크롤 스냅 설정 */
        .snap-container {
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
        }
        
        .snap-section {
            scroll-snap-align: start;
            scroll-snap-stop: always;
        }
        
        /* 이미지 최적화 */
        .intro-image {
            object-fit: cover;
            object-position: center;
            width: 100%;
            height: 100vh;
        }
        
        /* 모바일에서 이미지 비율 유지 */
        @media (max-width: 768px) {
            .intro-image {
                object-fit: contain;
                background-color: #f8fafc;
            }
        }
        
        /* 네비게이션 도트 */
        .nav-dot {
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .nav-dot.active {
            transform: scale(1.3);
            background-color: white;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        /* 스크롤 인디케이터 애니메이션 */
        .scroll-indicator {
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }
        
        /* 로딩 스피너 */
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 오버레이 콘텐츠 페이드 인 */
        .fade-in {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s ease;
        }
        
        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-gray-900 overflow-x-hidden">
    
    <!-- 로딩 화면 제거 (임시) -->
    <div id="loading" class="fixed inset-0 bg-black z-50 flex items-center justify-center transition-opacity duration-500" style="display: none;">
        <div class="text-center text-white">
            <div class="loading-spinner mx-auto mb-4"></div>
            <div class="text-lg font-light">어덕해 로딩 중...</div>
        </div>
    </div>
    
    <!-- 상단 네비게이션 바 -->
    <nav class="fixed top-0 left-0 right-0 z-40 bg-black bg-opacity-80 backdrop-blur-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- 로고 -->
                <div class="flex-shrink-0">
                    <a href="/" class="text-white text-xl font-bold hover:text-gray-300 transition-colors">
                        어덕해
                    </a>
                </div>
                
                <!-- 네비게이션 메뉴 -->
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="/" class="text-gray-300 hover:text-white px-3 py-2 text-sm font-medium transition-colors">
                            홈
                        </a>
                        <a href="/ddokfarm/" class="text-gray-300 hover:text-white px-3 py-2 text-sm font-medium transition-colors">
                            덕팜
                        </a>
                        <a href="/ddokdam/" class="text-gray-300 hover:text-white px-3 py-2 text-sm font-medium transition-colors">
                            덕담
                        </a>
                        <a href="/calendar/" class="text-gray-300 hover:text-white px-3 py-2 text-sm font-medium transition-colors">
                            덕생
                        </a>
                    </div>
                </div>
                
                <!-- CTA 버튼 -->
                <div class="flex items-center space-x-3">
                    {% if user.is_authenticated %}
                        <span class="text-gray-300 text-sm">{{ user.display_name }}님</span>
                        <a href="/accounts/logout/" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-full text-sm font-medium transition-colors">
                            로그아웃
                        </a>
                    {% else %}
                        <a href="/accounts/login/" class="text-white hover:text-gray-300 px-3 py-2 text-sm font-medium transition-colors">
                            로그인
                        </a>
                        <a href="/accounts/signup/" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full text-sm font-medium transition-colors">
                            회원가입
                        </a>
                    {% endif %}
                </div>
                
                <!-- 모바일 메뉴 버튼 -->
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-gray-300 hover:text-white p-2">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 모바일 메뉴 -->
        <div id="mobile-menu" class="md:hidden hidden bg-black bg-opacity-90">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="/" class="text-gray-300 hover:text-white block px-3 py-2 text-base font-medium">홈</a>
                <a href="/ddokfarm/" class="text-gray-300 hover:text-white block px-3 py-2 text-base font-medium">덕팜</a>
                <a href="/ddokdam/" class="text-gray-300 hover:text-white block px-3 py-2 text-base font-medium">덕담</a>
                <a href="/calendar/" class="text-gray-300 hover:text-white block px-3 py-2 text-base font-medium">덕생</a>
            </div>
        </div>
    </nav>
    
    <!-- 우측 네비게이션 도트 -->
    <div class="fixed right-4 md:right-8 top-1/2 transform -translate-y-1/2 z-40 space-y-3">
        <div class="nav-dot w-3 h-3 bg-white bg-opacity-50 rounded-full cursor-pointer transition-all hover:bg-opacity-80 active" data-section="0" title="메인 소개"></div>
        <div class="nav-dot w-3 h-3 bg-white bg-opacity-50 rounded-full cursor-pointer transition-all hover:bg-opacity-80" data-section="1" title="덕팜 소개"></div>
        <div class="nav-dot w-3 h-3 bg-white bg-opacity-50 rounded-full cursor-pointer transition-all hover:bg-opacity-80" data-section="2" title="덕담 소개"></div>
        <div class="nav-dot w-3 h-3 bg-white bg-opacity-50 rounded-full cursor-pointer transition-all hover:bg-opacity-80" data-section="3" title="덕생 소개"></div>
        <div class="nav-dot w-3 h-3 bg-white bg-opacity-50 rounded-full cursor-pointer transition-all hover:bg-opacity-80" data-section="4" title="시작하기"></div>
    </div>
    
    <!-- 메인 컨테이너 -->
    <main class="h-screen overflow-y-auto snap-container" id="main-container">
        
        <!-- 동적으로 10개 슬라이드 생성 -->
        {% for i in "0123456789" %}
        <section class="snap-section h-screen relative" id="section-{{ forloop.counter0 }}">
            <img src="{% static 'image/slide/intro_slide_' %}{{ forloop.counter }}.jpg" 
                 alt="어덕해 소개 슬라이드 {{ forloop.counter }}" 
                 class="intro-image"
                 {% if forloop.first %}loading="eager"{% else %}loading="lazy"{% endif %}>
            
            {% if forloop.first %}
            <!-- 첫 번째 슬라이드 오버레이 -->
            <div class="absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center">
                <div class="text-center text-white fade-in">
                    <h1 class="text-4xl md:text-6xl font-bold mb-4">어덕해</h1>
                    <p class="text-lg md:text-xl mb-8 max-w-2xl">
                        팬들을 위한 특별한 공간에서<br>
                        덕질의 모든 것을 경험하세요
                    </p>
                </div>
            </div>
            
            <!-- 스크롤 힌트 -->
            <div class="scroll-indicator absolute bottom-8 left-1/2 transform -translate-x-1/2 text-white text-center">
                <div class="text-sm mb-2 opacity-80">아래로 스크롤하세요</div>
                <svg class="w-6 h-6 mx-auto opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>
                </svg>
            </div>
            {% endif %}
            
            {% if forloop.last %}
            <!-- 마지막 슬라이드 CTA -->
            <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center">
                <div class="text-center text-white fade-in">
                    <h2 class="text-4xl md:text-6xl font-bold mb-6">덕질 여정 시작</h2>
                    <p class="text-lg md:text-xl mb-8 max-w-3xl mx-auto">
                        어덕해에서 새로운 덕질 경험을 시작해보세요<br>
                        팬들과 함께하는 특별한 순간들이 기다리고 있습니다
                    </p>
                    <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
                        {% if not user.is_authenticated %}
                            <a href="/accounts/signup/" 
                               class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-4 rounded-full text-lg font-semibold transition-all transform hover:scale-105 shadow-xl">
                                지금 시작하기
                            </a>
                            <a href="/" 
                               class="border-2 border-white text-white hover:bg-white hover:text-black px-8 py-4 rounded-full text-lg font-semibold transition-all">
                                둘러보기
                            </a>
                        {% else %}
                            <a href="/" 
                               class="bg-white text-black hover:bg-gray-100 px-8 py-4 rounded-full text-lg font-semibold transition-all transform hover:scale-105 shadow-xl">
                                메인으로 돌아가기
                            </a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}
        </section>
        {% endfor %}
        
    </main>
    
    <!-- 진행률 표시바 -->
    <div class="fixed bottom-0 left-0 right-0 z-30">
        <div class="bg-gray-800 bg-opacity-50 h-1">
            <div id="progress-bar" class="bg-white h-full transition-all duration-300" style="width: 20%"></div>
        </div>
    </div>
    
    <!-- JavaScript -->
    <script>
        // 전역 변수
        let currentSection = 0;
        const totalSections = 10;  // 10개 슬라이드
        let isScrolling = false;
        let touchStartY = 0;
        
        // DOM 요소
        const mainContainer = document.getElementById('main-container');
        const loading = document.getElementById('loading');
        const navDots = document.querySelectorAll('.nav-dot');
        const progressBar = document.getElementById('progress-bar');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        
        // 이미지 로딩 관리 (간소화)
        function checkImagesLoaded() {
            // 바로 로딩 완료 처리
            setTimeout(() => {
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.style.display = 'none';
                    initializeApp();
                }, 500);
            }, 1000); // 1초 후 로딩 완료
        }
        
        // 페이지 로드 즉시 초기화
        document.addEventListener('DOMContentLoaded', checkImagesLoaded);
        
        // 앱 초기화
        function initializeApp() {
            updateNavigation();
            setupEventListeners();
            updateProgressBar();
            
            // 페이드 인 효과
            setTimeout(() => {
                document.querySelectorAll('.fade-in').forEach(el => {
                    el.classList.add('visible');
                });
            }, 500);
        }
        
        // 네비게이션 업데이트
        function updateNavigation() {
            navDots.forEach((dot, index) => {
                if (index === currentSection) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
        }
        
        // 진행률 바 업데이트
        function updateProgressBar() {
            const progress = ((currentSection + 1) / totalSections) * 100;
            progressBar.style.width = progress + '%';
        }
        
        // 특정 섹션으로 이동
        function goToSection(sectionIndex) {
            if (sectionIndex < 0 || sectionIndex >= totalSections || isScrolling) return;
            
            isScrolling = true;
            currentSection = sectionIndex;
            
            const targetSection = document.getElementById(`section-${sectionIndex}`);
            targetSection.scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
            
            updateNavigation();
            updateProgressBar();
            
            setTimeout(() => {
                isScrolling = false;
            }, 1000);
        }
        
        // 이벤트 리스너 설정
        function setupEventListeners() {
            // 네비게이션 도트 클릭
            navDots.forEach((dot, index) => {
                dot.addEventListener('click', () => goToSection(index));
            });
            
            // 모바일 메뉴 토글
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
            
            // 키보드 네비게이션
            document.addEventListener('keydown', (e) => {
                if (isScrolling) return;
                
                switch(e.key) {
                    case 'ArrowDown':
                    case ' ':
                        e.preventDefault();
                        if (currentSection < totalSections - 1) {
                            goToSection(currentSection + 1);
                        }
                        break;
                    case 'ArrowUp':
                        e.preventDefault();
                        if (currentSection > 0) {
                            goToSection(currentSection - 1);
                        }
                        break;
                    case 'Home':
                        e.preventDefault();
                        goToSection(0);
                        break;
                    case 'End':
                        e.preventDefault();
                        goToSection(totalSections - 1);
                        break;
                }
            });
            
            // 터치 이벤트 (모바일)
            mainContainer.addEventListener('touchstart', (e) => {
                touchStartY = e.touches[0].clientY;
            }, { passive: true });
            
            mainContainer.addEventListener('touchend', (e) => {
                if (isScrolling) return;
                
                const touchEndY = e.changedTouches[0].clientY;
                const diff = touchStartY - touchEndY;
                const threshold = 50;
                
                if (Math.abs(diff) > threshold) {
                    if (diff > 0 && currentSection < totalSections - 1) {
                        goToSection(currentSection + 1);
                    } else if (diff < 0 && currentSection > 0) {
                        goToSection(currentSection - 1);
                    }
                }
            }, { passive: true });
            
            // 스크롤 이벤트 감지
            let scrollTimeout;
            mainContainer.addEventListener('scroll', () => {
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    if (!isScrolling) {
                        detectCurrentSection();
                    }
                }, 100);
            }, { passive: true });
        }
        
        // 현재 섹션 감지
        function detectCurrentSection() {
            const scrollTop = mainContainer.scrollTop;
            const windowHeight = window.innerHeight;
            const newSection = Math.round(scrollTop / windowHeight);
            
            if (newSection !== currentSection && newSection >= 0 && newSection < totalSections) {
                currentSection = newSection;
                updateNavigation();
                updateProgressBar();
            }
        }
        
        console.log('어덕해 소개 페이지 로드 완료');
    </script>
</body>
</html>