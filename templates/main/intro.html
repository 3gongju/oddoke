{# templates/main/intro.html #}
<!DOCTYPE html>
{% load static %}
<html lang="ko" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <title>{{ page_title }} - 어덕해</title>

    <!-- 100% 줌 고정 및 스크롤 줌 방지 -->
    <style>
    /* 전체 페이지 100% 줌 고정 */
    html {
        zoom: 1.0;
        -moz-transform: scale(1.0);
        -moz-transform-origin: 0 0;
        -webkit-transform: scale(1.0);
        -webkit-transform-origin: 0 0;
        transform: scale(1.0);
        transform-origin: 0 0;
        
        /* 사용자의 줌 조정 방지 */
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        
        /* 터치 줌 방지 */
        -webkit-touch-callout: none;
        -webkit-tap-highlight-color: transparent;
        touch-action: pan-y;
    }

    /* Firefox 전용 보정 */
    @-moz-document url-prefix() {
        html {
            zoom: 1;
            -moz-transform: scale(1.0);
            width: 100%; /* 100% / 1.0 = 100% */
            height: 100%;
        }
        
        body {
            width: 100vw;
            height: 100vh;
            overflow-x: hidden;
        }
    }

    /* 스크롤바 영역 조정 */
    body {
        width: 100vw;
        height: 100vh;
        overflow-x: hidden;
    }

    /* 마우스 휠 줌 방지 */
    .zoom-disabled {
        pointer-events: auto;
    }

    /* 키보드 줌 단축키 방지를 위한 포커스 제거 */
    * {
        outline: none;
    }

    /* 덕담 카드 전용 추가 스타일 */
    .intro-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        text-decoration: none;
        border-radius: 25px;
        font-weight: 500;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
    }
    
    .intro-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(255, 255, 255, 0.2);
    }
    </style>

    <!-- 마우스 휠 줌 방지 JavaScript -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // 마우스 휠 + Ctrl 키 조합으로 줌 방지
        document.addEventListener('wheel', function(e) {
            if (e.ctrlKey) {
                e.preventDefault();
                return false;
            }
        }, { passive: false });
        
        // 키보드 줌 단축키 방지
        document.addEventListener('keydown', function(e) {
            // Ctrl + +, Ctrl + -, Ctrl + 0 방지
            if (e.ctrlKey && (e.key === '+' || e.key === '-' || e.key === '0' || e.key === '=' || e.key === '_')) {
                e.preventDefault();
                return false;
            }
            
            // Ctrl + 마우스휠 방지
            if (e.ctrlKey && (e.keyCode === 107 || e.keyCode === 109 || e.keyCode === 187 || e.keyCode === 189)) {
                e.preventDefault();
                return false;
            }
        });
        
        // 터치 줌 방지 (모바일)
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });
        
        document.addEventListener('touchmove', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });
        
        // 더블탭 줌 방지 (모바일)
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(e) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
        
        // 브라우저 줌 레벨 강제 재설정 (일부 브라우저용)
        function enforceZoom() {
            if (document.body.style.zoom !== '1.0') {
                document.documentElement.style.zoom = '1.0';
                document.body.style.zoom = '1.0';
            }
        }
        
        // 정기적으로 줌 레벨 체크
        setInterval(enforceZoom, 500);
        
        console.log('어덕해 인트로: 100% 줌 고정 모드 활성화');
    });
    </script>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="어덕해 - 팬들을 위한 특별한 공간. 굿즈 거래, 팬 커뮤니티, 생일 달력 등 덕질의 모든 것을 경험하세요.">
    <meta name="keywords" content="덕질, 굿즈거래, 팬커뮤니티, K-POP, 아이돌, 덕팜, 덕담, 생일달력">
    <meta name="author" content="어덕해">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph Meta Tags (Facebook, 카카오톡 등) -->
    <meta property="og:title" content="어덕해 - 팬들을 위한 특별한 공간">
    <meta property="og:description" content="굿즈 거래, 팬 커뮤니티, 생일 달력 등 덕질의 모든 것을 한 곳에서 경험하세요.">
    <meta property="og:image" content="{% static 'image/slide/intro_slide_default.jpg' %}">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="어덕해">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="어덕해 - 팬들을 위한 특별한 공간">
    <meta name="twitter:description" content="굿즈 거래, 팬 커뮤니티, 생일 달력 등 덕질의 모든 것을 한 곳에서 경험하세요.">
    <meta name="twitter:image" content="{% static 'image/slide/intro_slide_default.jpg' %}">
    
    <!-- Performance Optimization -->
    <link rel="preload" href="{% static 'image/slide/intro_slide_default.jpg' %}" as="image">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
    <link rel="apple-touch-icon" href="{% static 'apple-touch-icon.png' %}">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 인트로 로고 전용 CSS 추가 -->
    <link rel="stylesheet" href="{% static 'css/intro/intro_logo.css' %}">

    <!-- 기존 CSS 링크 아래에 추가 -->
    <link rel="stylesheet" href="{% static 'css/intro/intro_ddokfarm.css' %}">
    <link rel="stylesheet" href="{% static 'css/intro/intro_ddokdam.css' %}">
    <link rel="stylesheet" href="{% static 'css/intro/cafe_map.css' %}">
    <link rel="stylesheet" href="{% static 'css/intro/safety_intro.css' %}">
    <link rel="stylesheet" href="{% static 'css/intro/favorite_artists_intro.css' %}">
    <link rel="stylesheet" href="{% static 'css/intro/ddokgame_intro.css' %}">
    
    <!-- 커스텀 스타일 -->
    <style>
        /* 스크롤바 숨기기 - 모든 브라우저 대응 */
        .snap-container {
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
            /* 스크롤바 숨기기 */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* Internet Explorer 10+ */
        }

        .snap-container::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        /* body 전체 스크롤바도 숨기기 */
        body {
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* Internet Explorer 10+ */
        }

        body::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        /* 스크롤 스냅 설정 */
        .snap-container {
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
        }
        
        .snap-section {
            scroll-snap-align: start;
            scroll-snap-stop: always;
        }
        
        /* 이미지 최적화 */
        .intro-image {
            object-fit: cover;
            object-position: center;
            width: 100%;
            height: 100vh;
            /* 이미지 압축 품질 향상 */
            image-rendering: -webkit-optimize-contrast;
            image-rendering: optimize-contrast;
            /* 레이지 로딩 지원 */
            content-visibility: auto;
        }
        
        /* 고해상도 디스플레이 대응 */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .intro-image {
                image-rendering: -webkit-optimize-contrast;
                image-rendering: crisp-edges;
            }
        }
        
        /* 접근성 개선 - 모션 감소 설정 */
        @media (prefers-reduced-motion: reduce) {
            .snap-container {
                scroll-behavior: auto;
            }
            
            .fade-in,
            .scroll-indicator,
            .nav-dot {
                animation: none;
                transition: none;
            }
            
            .loading-spinner {
                animation: none;
            }
        }
        
        /* 인터넷 익스플로러 대응 */
        @media screen and (-ms-high-contrast: active), (-ms-high-contrast: none) {
            .intro-image {
                object-fit: cover;
                height: 100vh;
            }
        }
        
        /* 모바일에서 이미지 비율 유지 */
        @media (max-width: 768px) {
            .intro-image {
                object-fit: contain;
                background-color: #f8fafc;
            }
        }
        
        /* 네비게이션 도트 */
        .nav-dot {
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .nav-dot.active {
            transform: scale(1.3);
            background-color: white;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        /* 스크롤 인디케이터 애니메이션 */
        .scroll-indicator {
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }
        
        /* 로딩 스피너 */
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 오버레이 콘텐츠 페이드 인 */
        .fade-in {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s ease;
        }
        
        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* 네비게이션 도트 컨테이너 스크롤 */
        .nav-dots-container {
            max-height: 80vh;
            overflow-y: auto;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* Internet Explorer 10+ */
        }

        .nav-dots-container::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }
                
                /* 통계 카운터 애니메이션 */
                .counter {
                    font-variant-numeric: tabular-nums;
                }
    </style>
</head>
<body class="bg-gray-900 overflow-x-hidden">
    
    <!-- 로딩 화면 -->
    <div id="loading" class="fixed inset-0 bg-black z-50 flex items-center justify-center transition-opacity duration-500">
        <div class="text-center text-white">
            <div class="loading-spinner mx-auto mb-4"></div>
            <div class="text-lg font-light">어덕해 로딩 중...</div>
        </div>
    </div>
    
    <!-- 상단 네비게이션 바 -->
    <nav class="fixed top-0 left-0 right-0 z-40 bg-black bg-opacity-80 backdrop-blur-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- 로고 -->
                <div class="flex-shrink-0">
                    <a href="/" class="text-white text-xl font-bold hover:text-gray-300 transition-colors">
                        어덕해
                    </a>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- 우측 네비게이션 도트 -->
    <div class="fixed right-4 md:right-8 top-1/2 transform -translate-y-1/2 z-40">
        <div class="nav-dots-container space-y-2">
            {% for slide in slide_contents %}
            <div class="nav-dot w-1 h-1 bg-white bg-opacity-50 rounded-full cursor-pointer transition-all hover:bg-opacity-80 {% if forloop.first %}active{% endif %}" 
                 data-section="{{ forloop.counter0 }}" 
                 title="{{ slide.subtitle }}"></div>
            {% endfor %}
        </div>
    </div>
    
    <!-- 메인 컨테이너 -->
    <main class="h-screen overflow-y-auto snap-container" id="main-container">
        
        <!-- 슬라이드 동적 생성 -->
        {% for slide in slide_contents %}
        <section class="snap-section h-screen relative" id="section-{{ forloop.counter0 }}">
            <img src="{% static slide.image %}" 
                 alt="어덕해 소개 슬라이드 {{ forloop.counter }} - {{ slide.title }}" 
                 class="intro-image"
                 loading="eager">
            
            <!-- 슬라이드별 오버레이 콘텐츠 -->
            <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center">
                <div class="text-center text-white fade-in px-4 max-w-4xl">
                    
                    {% if slide.type == 'welcome' %}
                    <!-- 첫 번째 슬라이드 - 웰컴 -->
                    <h1 class="text-4xl md:text-6xl font-bold mb-6">{{ slide.title }}</h1>
                    <p class="text-lg md:text-xl mb-8 max-w-2xl mx-auto">
                        {{ slide.subtitle }}<br> 
                        {{ slide.description }}
                    </p>
                    <!--로고 이미지 추가 -->
                    <div class="logo-container mb-6">
                        <img src="{% static 'image/ddok_logo_filled.png' %}" 
                            alt="어덕해 로고" 
                            class="intro-logo mx-auto w-24 h-24 md:w-32 md:h-32 lg:w-40 lg:h-40 object-contain drop-shadow-2xl">
                    </div>

                    {% elif slide.type == 'cta' %}
                    <!-- 마지막 슬라이드 - CTA -->
                    <h2 class="text-4xl md:text-6xl font-bold mb-6">{{ slide.title }}</h2>
                    <p class="text-lg md:text-xl mb-8 max-w-3xl mx-auto">
                        {{ slide.subtitle }}<br>
                        {{ slide.description }}
                    </p>
                    
                    <!-- 통계 정보 -->
                    {% if stats.total_users > 0 %}
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8 max-w-2xl mx-auto">
                        <div class="text-center">
                            <div class="text-2xl md:text-3xl font-bold counter">{{ stats.total_users }}</div>
                            <div class="text-sm opacity-80">활성 사용자</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl md:text-3xl font-bold counter">{{ stats.total_artists }}</div>
                            <div class="text-sm opacity-80">등록 아티스트</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl md:text-3xl font-bold counter">{{ stats.total_posts }}</div>
                            <div class="text-sm opacity-80">게시물</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl md:text-3xl font-bold counter">{{ stats.total_trades }}</div>
                            <div class="text-sm opacity-80">거래 완료</div>
                        </div>
                    </div>
                    {% endif %}
                    
                    <!-- CTA 버튼 -->
                    <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
                        {% if not user.is_authenticated %}
                            <a href="/accounts/signup/" 
                               class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-4 rounded-full text-lg font-semibold transition-all transform hover:scale-105 shadow-xl">
                                지금 시작하기
                            </a>
                            <a href="/" 
                               class="border-2 border-white text-white hover:bg-white hover:text-black px-8 py-4 rounded-full text-lg font-semibold transition-all">
                                둘러보기
                            </a>
                        {% else %}
                            <a href="/" 
                               class="bg-white text-black hover:bg-gray-100 px-8 py-4 rounded-full text-lg font-semibold transition-all transform hover:scale-105 shadow-xl">
                                메인으로 돌아가기
                            </a>
                        {% endif %}
                    </div>
                    
                    {% else %}
                    <!-- 모든 일반 슬라이드의 공통 헤더 -->
                    <h2 class="text-3xl md:text-5xl font-bold mb-4">{{ slide.title }}</h2>
                    <h3 class="text-xl md:text-2xl mb-6 text-pink-200">{{ slide.subtitle }}</h3>
                    <p class="text-base md:text-lg max-w-2xl mx-auto leading-relaxed mb-6">
                        {{ slide.description }}
                    </p>

                    <!-- 슬라이드 타입별 콘텐츠만 -->
                    {% if slide.type == 'ddokfarm' %}
                        {% include 'main/intro/intro_ddokfarm_form.html' %}

                    {% elif slide.type == 'ddokdam' %}
                        {% include 'main/intro/intro_ddokdam_form.html' %}

                    {% elif slide.type == 'favorite_artists' %}
                        {% include 'main/intro/favorite_artists_slide.html' %}

                    {% elif slide.type == 'ddoksang' %}
                        {% include 'main/intro/cafe_map_slide.html' %}

                    {% elif slide.type == 'ddokchat' %}
                        {% include 'main/intro/ddokchat_slide.html' %}
                        
                    {% elif slide.type == 'safety' %}
                        {% include 'main/intro/safety_slide.html' %}

                    {% elif slide.type == 'ddokgame' %}
                        {% include 'main/intro/ddokgame_slide.html' %}
                    {% endif %}

                    {% endif %}
                </div>
            </div>
            
            {% if forloop.first %}
            <!-- 첫 번째 슬라이드에만 스크롤 힌트 표시 -->
            <div class="scroll-indicator absolute bottom-8 left-1/2 transform -translate-x-1/2 text-white text-center">
                <svg class="w-6 h-6 mx-auto opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>
                </svg>
            </div>
            {% endif %}
        </section>
        {% endfor %}
        
    </main>

    <!-- 진행률 표시바 -->
    <div class="fixed bottom-0 left-0 right-0 z-30">
        <div class="bg-gray-800 bg-opacity-50 h-1">
            <div id="progress-bar" class="bg-white h-full transition-all duration-300" style="width: 0%"></div>
        </div>
    </div>

    <!-- JavaScript 파일들을 body 안쪽에 로드 -->
    <script src="{% static 'js/intro/intro_ddokfarm.js' %}"></script>
    <script src="{% static 'js/intro/intro_ddokdam.js' %}"></script>
    <script src="{% static 'js/intro/favorite_artists_intro.js' %}"></script>
    <script src="{% static 'js/intro/ddokgame_intro.js' %}"></script>
    
    <!-- 메인 JavaScript -->
    <script>
        // 전역 변수
        let currentSection = 0;
        const totalSections = {{ total_slides }};
        let isScrolling = false;
        let touchStartY = 0;
        
        // DOM 요소
        const mainContainer = document.getElementById('main-container');
        const loading = document.getElementById('loading');
        const navDots = document.querySelectorAll('.nav-dot');
        const progressBar = document.getElementById('progress-bar');
        
        // 이미지 로딩 관리
        function checkImagesLoaded() {
            console.log('단일 이미지 로딩 체크 시작...');
            
            const firstImage = document.querySelector('.intro-image');
            
            if (firstImage && firstImage.complete && firstImage.naturalHeight !== 0) {
                console.log('이미지 로딩 완료');
                finishLoading();
            } else {
                setTimeout(() => {
                    console.log('1초 타임아웃, 강제 로딩 완료');
                    finishLoading();
                }, 1000);
            }
        }
        
        function finishLoading() {
            console.log('로딩 완료 처리 시작');
            loading.style.opacity = '0';
            setTimeout(() => {
                loading.style.display = 'none';
                initializeApp();
                console.log('앱 초기화 완료');
            }, 500);
        }
        
        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM 로드 완료');
            // JavaScript 파일들이 로드되기를 잠시 기다림
            setTimeout(() => {
                checkImagesLoaded();
            }, 200);
        });
        
        window.addEventListener('load', () => {
            console.log('윈도우 로드 완료');
            if (loading.style.display !== 'none') {
                console.log('백업 로딩 완료 처리');
                finishLoading();
            }
        });
        
        // 앱 초기화
        function initializeApp() {
            updateNavigation();
            setupEventListeners();
            updateProgressBar();
            
            setTimeout(() => {
                document.querySelectorAll('.fade-in').forEach(el => {
                    el.classList.add('visible');
                });
            }, 500);
            
            if (currentSection === totalSections - 1) {
                animateCounters();
            }
        }
        
        // 카운터 애니메이션
        function animateCounters() {
            const counters = document.querySelectorAll('.counter');
            counters.forEach(counter => {
                const target = parseInt(counter.textContent);
                if (target > 0) {
                    let current = 0;
                    const increment = target / 50;
                    const timer = setInterval(() => {
                        current += increment;
                        if (current >= target) {
                            current = target;
                            clearInterval(timer);
                        }
                        counter.textContent = Math.floor(current).toLocaleString();
                    }, 40);
                }
            });
        }
        
        // 네비게이션 업데이트
        function updateNavigation() {
            navDots.forEach((dot, index) => {
                if (index === currentSection) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
        }
        
        // 진행률 바 업데이트
        function updateProgressBar() {
            const progress = ((currentSection + 1) / totalSections) * 100;
            progressBar.style.width = progress + '%';
        }
        
        // 안전한 게임 초기화 함수 (강화된 버전)
        function safeInitDdokGame() {
            console.log('🎮 안전한 게임 초기화 시작');
            
            let retryCount = 0;
            const maxRetries = 15;
            
            function attemptInit() {
                console.log(`🎮 초기화 시도 ${retryCount + 1}/${maxRetries}`);
                
                // 기존 인스턴스 정리
                if (typeof window.destroyDdokGameIntroSlide === 'function') {
                    try {
                        window.destroyDdokGameIntroSlide();
                        console.log('🎮 기존 인스턴스 정리 완료');
                    } catch (e) {
                        console.warn('🎮 기존 인스턴스 정리 중 에러:', e);
                    }
                }
                
                // 1순위: initDdokGameIntroSlide 함수 사용
                if (typeof window.initDdokGameIntroSlide === 'function') {
                    try {
                        console.log('🎮 initDdokGameIntroSlide 함수로 초기화');
                        window.initDdokGameIntroSlide();
                        console.log('🎮 게임 초기화 성공!');
                        return true;
                    } catch (e) {
                        console.error('🎮 함수 초기화 실패:', e);
                    }
                }
                
                // 2순위: DdokGameIntroSlide 클래스 직접 사용
                if (typeof window.DdokGameIntroSlide === 'function') {
                    try {
                        console.log('🎮 클래스로 직접 초기화');
                        window.ddokGameIntroSlide = new window.DdokGameIntroSlide();
                        console.log('🎮 클래스 초기화 성공!');
                        return true;
                    } catch (e) {
                        console.error('🎮 클래스 초기화 실패:', e);
                    }
                }
                
                // 3순위: 대체 초기화
                if (fallbackGameInit()) {
                    console.log('🎮 대체 초기화 성공!');
                    return true;
                }
                
                return false;
            }
            
            // 초기화 시도
            if (attemptInit()) {
                return;
            }
            
            // 실패시 재시도
            retryCount++;
            if (retryCount < maxRetries) {
                console.log(`🎮 ${retryCount * 300}ms 후 재시도`);
                setTimeout(() => {
                    safeInitDdokGame();
                }, retryCount * 300); // 점진적으로 지연 시간 증가
            } else {
                console.error('🎮 최대 재시도 횟수 초과, 대체 초기화 실행');
                fallbackGameInit();
            }
        }
        
        // 대체 초기화 함수 (강화된 버전)
        function fallbackGameInit() {
            console.log('🎮 대체 초기화 시작');
            
            // 기본적인 시간 표시만 구현
            const timeMain = document.querySelector('.time-main');
            const timeMs = document.querySelector('.time-ms');
            
            if (timeMain && timeMs) {
                console.log('🎮 시간 표시 요소 발견, 기본 시간 표시 시작');
                
                let animationId = null;
                
                const updateTime = () => {
                    const now = new Date();
                    const hours = String(now.getHours()).padStart(2, '0');
                    const minutes = String(now.getMinutes()).padStart(2, '0');
                    const seconds = String(now.getSeconds()).padStart(2, '0');
                    const milliseconds = String(now.getMilliseconds()).padStart(3, '0');
                    
                    timeMain.textContent = `${hours}:${minutes}:${seconds}`;
                    timeMs.textContent = `.${milliseconds}`;
                    
                    animationId = requestAnimationFrame(updateTime);
                };
                
                updateTime();
                
                // 정리 함수를 전역에 저장
                window.fallbackCleanup = () => {
                    if (animationId) {
                        cancelAnimationFrame(animationId);
                        animationId = null;
                        console.log('🎮 대체 시간 표시 정리 완료');
                    }
                };
                
                console.log('🎮 대체 시간 표시 시작 완료');
                return true;
            } else {
                console.warn('🎮 시간 표시 요소를 찾을 수 없음');
                return false;
            }
        }
        
        // 특정 섹션으로 이동
        function goToSection(sectionIndex) {
            if (sectionIndex < 0 || sectionIndex >= totalSections || isScrolling) return;
            
            isScrolling = true;
            currentSection = sectionIndex;
            
            const targetSection = document.getElementById(`section-${sectionIndex}`);
            targetSection.scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
            
            updateNavigation();
            updateProgressBar();

            // 🎮 게임 슬라이드 감지
            const gameSlideIndex = 7; // ddokgame 슬라이드 인덱스
            if (sectionIndex === gameSlideIndex) {
                console.log('🎮 게임 슬라이드 진입:', sectionIndex);
                setTimeout(() => {
                    safeInitDdokGame();
                }, 1000); // 1초 후에 초기화 (충분한 여유 시간)
            } else {
                // 다른 슬라이드로 이동시 게임 정리
                if (typeof window.destroyDdokGameIntroSlide === 'function') {
                    try {
                        window.destroyDdokGameIntroSlide();
                        console.log('🎮 게임 인스턴스 정리 완료');
                    } catch (e) {
                        console.warn('🎮 게임 정리 중 에러:', e);
                    }
                }
                if (typeof window.fallbackCleanup === 'function') {
                    window.fallbackCleanup();
                }
            }
            
            // 마지막 슬라이드에서 카운터 애니메이션 실행
            if (sectionIndex === totalSections - 1) {
                setTimeout(() => {
                    animateCounters();
                }, 500);
            }
            
            setTimeout(() => {
                isScrolling = false;
            }, 1200);
        }
        
        // 이벤트 리스너 설정
        function setupEventListeners() {
            // 네비게이션 도트 클릭
            navDots.forEach((dot, index) => {
                dot.addEventListener('click', () => goToSection(index));
            });
            
            // 키보드 네비게이션
            document.addEventListener('keydown', (e) => {
                if (isScrolling) return;
                
                switch(e.key) {
                    case 'ArrowDown':
                    case ' ':
                        e.preventDefault();
                        if (currentSection < totalSections - 1) {
                            goToSection(currentSection + 1);
                        }
                        break;
                    case 'ArrowUp':
                        e.preventDefault();
                        if (currentSection > 0) {
                            goToSection(currentSection - 1);
                        }
                        break;
                    case 'Home':
                        e.preventDefault();
                        goToSection(0);
                        break;
                    case 'End':
                        e.preventDefault();
                        goToSection(totalSections - 1);
                        break;
                }
            });
            
            // 터치 이벤트 (모바일)
            mainContainer.addEventListener('touchstart', (e) => {
                touchStartY = e.touches[0].clientY;
            }, { passive: true });
            
            mainContainer.addEventListener('touchend', (e) => {
                if (isScrolling) return;
                
                const touchEndY = e.changedTouches[0].clientY;
                const diff = touchStartY - touchEndY;
                const threshold = 50;
                
                if (Math.abs(diff) > threshold) {
                    if (diff > 0 && currentSection < totalSections - 1) {
                        goToSection(currentSection + 1);
                    } else if (diff < 0 && currentSection > 0) {
                        goToSection(currentSection - 1);
                    }
                }
            }, { passive: true });
            
            // 스크롤 이벤트 감지
            let scrollTimeout;
            mainContainer.addEventListener('scroll', () => {
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    if (!isScrolling) {
                        detectCurrentSection();
                    }
                }, 100);
            }, { passive: true });
        }
        
        // 현재 섹션 감지
        function detectCurrentSection() {
            const scrollTop = mainContainer.scrollTop;
            const windowHeight = window.innerHeight;
            const newSection = Math.round(scrollTop / windowHeight);
            
            if (newSection !== currentSection && newSection >= 0 && newSection < totalSections) {
                currentSection = newSection;
                updateNavigation();
                updateProgressBar();
                
                // 게임 슬라이드 자동 감지
                if (currentSection === 7) {
                    setTimeout(() => {
                        safeInitDdokGame();
                    }, 800);
                } else {
                    // 다른 슬라이드에서는 게임 정리
                    if (typeof window.destroyDdokGameIntroSlide === 'function') {
                        try {
                            window.destroyDdokGameIntroSlide();
                        } catch (e) {
                            console.warn('🎮 자동 게임 정리 중 에러:', e);
                        }
                    }
                    if (typeof window.fallbackCleanup === 'function') {
                        window.fallbackCleanup();
                    }
                }
                
                // 마지막 슬라이드에서 카운터 애니메이션
                if (currentSection === totalSections - 1) {
                    animateCounters();
                }
            }
        }
        
        console.log(`어덕해 소개 페이지 로드 완료 - ${totalSections}개 슬라이드`);
    </script>
</body>
</html>