{# templates/main/home.html #}
{% extends 'base.html' %}
{% load static %}

{% block body %}

  <!-- ë°°ë„ˆ -->
  <section class="w-full bg-white py-6">
    <div class="max-w-screen-xl mx-auto h-[220px] overflow-hidden">
      <div id="bannerCarousel" class="w-full h-full relative">
        {% for path in banner_images %}
          <img src="{% static path %}"
               class="absolute top-0 left-0 w-full h-full object-cover
                      transition-opacity duration-1000
                      {% if forloop.first %}opacity-100{% else %}opacity-0{% endif %}" />
        {% endfor %}
      </div>
    </div>
  </section>

    <!-- ë•ì§ˆ ì¹´í…Œê³ ë¦¬ ë„¤ë¹„ -->
  <section class="mt-28 mb-20 max-w-6xl mx-auto px-4">
    <h2 class="text-center text-xl font-bold mb-10">ì–´ë•í•œë‹¤ê³ ?</h2>
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
      <a href="{% url 'ddokfarm:index' %}"
         class="bg-black text-white rounded-2xl px-6 py-8 text-center hover:brightness-110 transition">
        <h3 class="text-lg font-bold mb-2">ë•íŒœ</h3>
        <p class="text-sm opacity-80">êµ¿ì¦ˆ ì¤‘ê³  ê±°ë˜ Â· ëŒ€ì—¬ Â· ë¶„ì² </p>
      </a>
      <a href="{% url 'ddokdam:index' %}"
         class="bg-black text-white rounded-2xl px-6 py-8 text-center hover:brightness-110 transition">
        <h3 class="text-lg font-bold mb-2">ë•ë‹´</h3>
        <p class="text-sm opacity-80">ë•ì§ˆíŒ Â· ìë‘ Â· ì˜ˆì ˆìƒ·</p>
      </a>
      <a href="#"
         class="bg-black text-white rounded-2xl px-6 py-8 text-center hover:brightness-110 transition">
        <h3 class="text-lg font-bold mb-2">ë•ìƒ</h3>
        <p class="text-sm opacity-80">ìƒì¼ì¹´í˜ ì§€ë„ Â· ê¸°ë… ì •ë³´</p>
      </a>
    </div>
  </section>

  <!-- ì°œí•œ ì•„í‹°ìŠ¤íŠ¸ ì„¹ì…˜ -->
  <section class="mt-12">
    <div class="flex justify-between items-center px-6 mb-4 max-w-6xl mx-auto">
      <h3 class="text-lg font-bold text-red-500">â™¥ ë‚´ê°€ ì°œí•œ ë•</h3>
      <a href="{% url 'artist:index' %}" class="text-sm text-blue-600 hover:underline">ëª¨ë“  ë• â†’</a>
    </div>
    <div class="max-w-6xl mx-auto px-4">
      {% if raw_favs %}
        <!-- 1ëª… ì´ìƒ: í˜ì´ì§• ìºëŸ¬ì…€ -->
        <div class="relative">
          <!-- ì™¼ìª½ í™”ì‚´í‘œ -->
          <button onclick="moveArtistSlide(-1)"
                  class="absolute left-2 top-1/2 -translate-y-1/2 w-8 h-8 bg-white border rounded-full shadow hover:bg-gray-100 z-10">
            â†
          </button>
          <div class="overflow-hidden">
            <div id="artist-carousel-wrapper"
                 class="flex transition-transform duration-300 ease-in-out w-full">
              {% for group in grouped_artists %}
                <div class="flex justify-center space-x-4 px-6 min-w-full">
                  {% for artist in group %}
                    <div class="flex flex-col items-center w-[112px] shrink-0">
                      <a href="{% url 'artist:index' %}">
                        <div class="w-24 h-24 rounded-full overflow-hidden shadow">
                          <img src="{% static artist.logo %}"
                               alt="{{ artist.display_name }}"
                               class="w-full h-full object-cover" />
                        </div>
                      </a>
                      <p class="mt-1 text-xs sm:text-sm font-medium text-gray-700 text-center truncate w-full">
                        {{ artist.display_name }}
                      </p>
                    </div>
                  {% endfor %}
                </div>
              {% endfor %}
            </div>
          </div>
          <!-- ì˜¤ë¥¸ìª½ í™”ì‚´í‘œ -->
          <button onclick="moveArtistSlide(1)"
                  class="absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 bg-white border rounded-full shadow hover:bg-gray-100 z-10">
            â†’
          </button>
        </div>
      {% else %}
        <!-- 0ëª…: ê¸°ë³¸ ë¡œê³  + ì•ˆë‚´ ë¬¸êµ¬ -->
        <div class="flex flex-col items-center py-12 space-y-4">
          <img src="{% static 'image/ddok_black.png' %}"
               alt="ì°œí•œ ì•„í‹°ìŠ¤íŠ¸ ì—†ìŒ"
               class="w-24 h-24 object-contain" />
          <p class="text-gray-600 text-center">
            ì•„ì§ ì°œí•œ ë•ì´ ì—†ì–´ìš”!<br>
            <a href="{% url 'artist:index' %}"
               class="text-blue-600 hover:underline">
              ì°œë•í•˜ëŸ¬ ê°€ê¸°~
            </a>
          </p>
        </div>
      {% endif %}
    </div>
  </section>

<!-- âœ… ì´ë²ˆ ì£¼ ìƒì¼ ë©¤ë²„: FullCalendar ì£¼ê°„ ë·° -->
<section class="mt-28 mb-28 max-w-6xl mx-auto px-4">
  <div class="flex items-center justify-between mb-3">
    <h3 class="text-lg font-bold text-black">ğŸ‚ ì´ë²ˆ ì£¼ ìƒì¼ ë•</h3>
    <a href="{% url 'bday_calendar:calendar' %}" class="text-sm text-blue-600 hover:underline">ì „ì²´ ë³´ê¸° â†’</a>
  </div>

  <div id="home-calendar" class="overflow-x-auto"></div>

  <p id="no-events-message" class="text-sm text-gray-500 text-center mt-4 hidden">
    ğŸ˜¢ ì´ë²ˆ ì£¼ì— ìƒì¼ì¸ ë©¤ë²„ê°€ ì—†ì–´ìš”.
  </p>
</section>


  <!-- ì‹¤ì‹œê°„ ì¸ê¸° ë§Œë‘ -->
  <section class="mt-28 mb-28 px-4 md:px-8 max-w-6xl mx-auto">
    <div class="flex items-center justify-between mb-6">
      <h3 class="text-xl font-bold">ì‹¤ì‹œê°„ ì¸ê¸° ë§Œë‘</h3>
      <a href="/ddokfarm/" class="text-sm text-blue-600 hover:underline">ì „ì²´ë³´ê¸° â†’</a>
    </div>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
      {% for post in latest_sell_posts %}
        <div class="border rounded shadow-sm p-3 text-center">
          <img src="{{ post.image.url }}" alt="{{ post.title }}" class="h-32 mx-auto object-contain" />
          <p class="mt-2 font-semibold">{{ post.title }}</p>
          <p class="text-sm text-gray-500">{{ post.price|default:"KRW 0" }}</p>
        </div>
      {% endfor %}
    </div>
  </section>

  <!-- ë•íŒœ + ë•ë‹´ ì „ì²´ ê²Œì‹œê¸€ -->
  <section class="mt-28 mb-28 px-4 md:px-8 max-w-6xl mx-auto">
    {% include 'main/components/all_sections.html' %}
  </section>

  <!-- ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // ë°°ë„ˆ ìŠ¬ë¼ì´ë“œ
      const slides = document.querySelectorAll("#bannerCarousel img");
      let idx = 0;
      setInterval(() => {
        slides[idx].classList.replace("opacity-100","opacity-0");
        idx = (idx + 1) % slides.length;
        slides[idx].classList.replace("opacity-0","opacity-100");
      }, 5000);
    });

    // ì°œí•œ ì•„í‹°ìŠ¤íŠ¸ í˜ì´ì§•
    const wrapper     = document.getElementById('artist-carousel-wrapper');
    const totalGroups = wrapper?.children.length || 0;
    let groupIndex    = 0;

    function moveArtistSlide(direction) {
      groupIndex = Math.max(0, Math.min(groupIndex + direction, totalGroups - 1));
      wrapper.style.transform = `translateX(-${groupIndex * 100}%)`;
    }

    window.addEventListener('resize', () => {
      groupIndex = 0;
      wrapper.style.transform = 'translateX(0%)';
    });
  </script>

  <!-- âœ… FullCalendar CSS & JS -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.5/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.5/index.global.min.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const calendarEl = document.getElementById('home-calendar');

    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridWeek',  // âœ… ì£¼ê°„ ë·°
      locale: 'ko',
      headerToolbar: false,
      events: '{% url "bday_calendar:weekly_events_api" %}',  // ì£¼ê°„ ìƒì¼ API
      eventColor: '#f472b6',
      nowIndicator: true,
      height: 'auto'
    });

    calendar.render();
  });
</script>



{% endblock %}
