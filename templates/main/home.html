{% extends 'base.html' %}
{% load static %}
{% block header %}{% endblock %}

{% block body %}
<!-- ✅ 배너 -->
<section class="w-full h-64 bg-yellow-100 flex items-center justify-center text-center">
  <div>
    <h1 class="text-3xl md:text-4xl font-extrabold text-gray-800">어떻게 덕질해? 어덕해!</h1>
    <p class="text-lg text-gray-600 mt-2">중고 굿즈 거래부터 대여, 생일카페까지</p>
  </div>
</section>

<!-- ✅ 찜한 아티스트 캐러셀 -->
<section class="mt-12 relative">
  <div class="flex justify-between items-center px-6 mb-4 max-w-6xl mx-auto">
    <h3 class="text-lg font-bold text-gray-800">♥ 내가 찜한 덕</h3>
    <a href="/artist/" class="text-sm text-blue-600 hover:underline">모든 덕 →</a>
  </div>

  <div class="relative max-w-6xl mx-auto flex items-center justify-center px-4">
    <!-- 왼쪽 화살표 -->
    <button onclick="moveSlide(-1)" class="absolute left-0 z-10 w-8 h-8 bg-white border rounded-full shadow hover:bg-gray-100 flex items-center justify-center -translate-x-1/2">
      &#8592;
    </button>

    <!-- 캐러셀 뷰포트 -->
    <div class="overflow-hidden" style="width: calc((112px + 16px) * 6);">
      <div id="carousel-inner" class="flex transition-transform duration-300 ease-in-out">
        {% for artist in favourite_artists %}
        <a href="/artist/" class="flex flex-col items-center w-[112px] mx-2 shrink-0">
          <img src="{% static artist.logo %}" alt="{{ artist.display_name }}"
               class="w-24 h-24 object-contain aspect-square rounded-full shadow">
          <p class="mt-1 text-xs sm:text-sm font-medium text-gray-700 text-center truncate w-full">
            {{ artist.display_name }}
          </p>
        </a>
        {% endfor %}
      </div>
    </div>

    <!-- 오른쪽 화살표 -->
    <button onclick="moveSlide(1)" class="absolute right-0 z-10 w-8 h-8 bg-white border rounded-full shadow hover:bg-gray-100 flex items-center justify-center translate-x-1/2">
      &#8594;
    </button>
  </div>
</section>

<!-- ✅ 주요 서비스 -->
<section class="mt-12 px-4 md:px-8 max-w-6xl mx-auto text-center">
  <h2 class="text-xl font-bold mb-6">주요 서비스</h2>
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <a href="/ddokfarm/" class="p-6 bg-blue-100 rounded-lg shadow hover:bg-blue-200">
      <p class="text-lg font-semibold">덕팜</p>
      <p class="text-sm text-gray-600 mt-1">굿즈 중고 거래, 대여, 분철</p>
    </a>
    <a href="/ddokdam/" class="p-6 bg-pink-100 rounded-lg shadow hover:bg-pink-200">
      <p class="text-lg font-semibold">덕담</p>
      <p class="text-sm text-gray-600 mt-1">덕질템 자랑, 예절샷</p>
    </a>
    <a href="#" class="p-6 bg-green-100 rounded-lg shadow hover:bg-green-200">
      <p class="text-lg font-semibold">덕생</p>
      <p class="text-sm text-gray-600 mt-1">생일카페, 지도 기반 정보</p>
    </a>
  </div>
</section>

<!-- ✅ 실시간 인기 굿즈 -->
<section class="mt-16 px-4 md:px-8 max-w-6xl mx-auto">
  <div class="flex items-center justify-between mb-6">
    <h3 class="text-xl font-bold">실시간 인기 굿즈</h3>
    <a href="/ddokfarm/" class="text-sm text-blue-600 hover:underline">전체보기 →</a>
  </div>
  <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
    <div class="border rounded shadow-sm p-3 text-center">
      <img src="{% static 'sample/lightstick.png' %}" alt="응원봉" class="h-32 mx-auto" />
      <p class="mt-2 font-semibold">NCT 공식 응원봉</p>
      <p class="text-sm text-gray-500">KRW 35,000</p>
    </div>
    <div class="border rounded shadow-sm p-3 text-center">
      <img src="{% static 'sample/photocard.png' %}" alt="포카" class="h-32 mx-auto" />
      <p class="mt-2 font-semibold">지민 포토카드</p>
      <p class="text-sm text-gray-500">KRW 12,000</p>
    </div>
    <div class="border rounded shadow-sm p-3 text-center">
      <img src="{% static 'sample/season.png' %}" alt="시즌그리팅" class="h-32 mx-auto" />
      <p class="mt-2 font-semibold">SEVENTEEN 시즌그리팅</p>
      <p class="text-sm text-gray-500">KRW 25,000</p>
    </div>
    <div class="border rounded shadow-sm p-3 text-center">
      <img src="{% static 'sample/lightstick2.png' %}" alt="응원봉" class="h-32 mx-auto" />
      <p class="mt-2 font-semibold">ENHYPEN 응원봉</p>
      <p class="text-sm text-gray-500">KRW 40,000</p>
    </div>
  </div>
</section>

<!-- ✅ 캐러셀 JS -->
<script>
  const inner = document.getElementById('carousel-inner');
  const cards = inner.querySelectorAll('a');
  let visibleCount = window.innerWidth < 768 ? 5 : 6;
  const cardWidth = 112.3 + 15.5; // 112px + mx-2

  let currentIndex = 0;

  function updateVisibleCount() {
    visibleCount = window.innerWidth < 768 ? 5 : 6;
    moveSlide(0);
  }

  function moveSlide(direction) {
    const totalCards = cards.length;
    const maxIndex = Math.ceil(totalCards / visibleCount) - 1;
    currentIndex = Math.max(0, Math.min(currentIndex + direction, maxIndex));
    const offset = currentIndex * visibleCount * cardWidth;
    inner.style.transform = `translateX(-${offset}px)`;
  }

  window.addEventListener('resize', updateVisibleCount);
  document.addEventListener('DOMContentLoaded', updateVisibleCount);
</script>
{% endblock %}
