
{% extends 'base.html' %}
{% load static %}

{% block body %}
<div class="max-w-4xl mx-auto px-4 py-10">
  <!-- âœ… í”„ë¡œí•„ ìƒë‹¨ - ë‹‰ë„¤ì„ë§Œ í‘œì‹œ -->
  <div class="bg-white p-6 rounded-lg shadow mb-8">
    <div class="flex items-center">
      <img src="{{ user_profile.profile_image.url }}" alt="í”„ë¡œí•„" class="w-16 h-16 rounded-full object-cover mr-4">
      <div>
        <h2 class="text-xl font-bold">
          {% if user_profile.first_name %}
            {{ user_profile.first_name }}
          {% elif user_profile.last_name %}
            {{ user_profile.last_name }}  
          {% elif user_profile.username|length > 20 %}
            ë‹‰ë„¤ì„ ë¯¸ì„¤ì •
          {% else %}
            {{ user_profile.username }}
          {% endif %}
        </h2>
      </div>
    </div>
  </div>

  <!-- âœ… ë¦¬ë·° íƒ­ ì˜ì—­ -->
  <div class="bg-white rounded-lg shadow p-6">
    <div class="flex space-x-6 mb-4 border-b pb-2">
      <button class="tab-btn text-blue-600 font-semibold border-b-2 border-blue-500" onclick="showTab('write')">ë¦¬ë·° ì“°ê¸°</button>
      <button class="tab-btn text-gray-500 hover:text-blue-500" onclick="showTab('written')">ë‚´ ë¦¬ë·°</button>
    </div>

    <!-- ë¦¬ë·° ì“°ê¸° ì˜ì—­ -->
    <div id="tab-write" class="tab-content">
      <form method="post" class="space-y-6" id="reviewForm">
        {% csrf_token %}
        
        <!-- âœ… 1. ì „ë°˜ì ì¸ ê±°ë˜ ë§Œì¡±ë„ (ë³„ì ) -->
        <div class="bg-gradient-to-r from-yellow-50 to-orange-50 p-6 rounded-xl border border-yellow-200">
          <label class="block text-lg font-bold text-gray-800 mb-4 text-center">1. ì „ë°˜ì ì¸ ê±°ë˜ ë§Œì¡±ë„</label>
          <div class="flex justify-center space-x-1 mb-3">
            <div class="rating-stars" data-field="rating">
              {% for i in "12345" %}
                <button type="button" class="star text-4xl text-gray-300 hover:text-yellow-400 transition-colors" data-value="{{ i }}">â˜…</button>
              {% endfor %}
            </div>
          </div>
          <p class="text-center text-sm text-gray-600" id="rating-text">ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”</p>
          {{ form.rating.as_hidden }}
        </div>

        <!-- âœ… 2. ì•½ì† ì‹œê°„ê³¼ ì¥ì†Œ -->
        <div class="bg-white p-5 rounded-xl border border-gray-200 shadow-sm">
          <label class="block text-base font-bold text-gray-800 mb-4 flex items-center">
            <span class="text-blue-500 mr-2">â°</span>
            2. ì•½ì† ì‹œê°„ê³¼ ì¥ì†Œ
          </label>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
            {% for choice in form.punctuality %}
              <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-blue-50 hover:border-blue-300 cursor-pointer transition-all">
                {{ choice.tag }}
                <span class="ml-3 text-sm font-medium text-gray-700">{{ choice.choice_label }}</span>
              </label>
            {% endfor %}
          </div>
        </div>

        <!-- âœ… 3. ìƒí’ˆ ìƒíƒœ -->
        <div class="bg-white p-5 rounded-xl border border-gray-200 shadow-sm">
          <label class="block text-base font-bold text-gray-800 mb-4 flex items-center">
            <span class="text-blue-500 mr-2">ğŸ“¦</span>
            3. ìƒí’ˆ ìƒíƒœ
          </label>
          <div class="space-y-2">
            {% for choice in form.description_match %}
              <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-blue-50 hover:border-blue-300 cursor-pointer transition-all">
                {{ choice.tag }}
                <span class="ml-3 text-sm font-medium text-gray-700">{{ choice.choice_label }}</span>
              </label>
            {% endfor %}
          </div>
        </div>

        <!-- âœ… 4. ì‘ë‹µ ì†ë„ -->
        <div class="bg-white p-5 rounded-xl border border-gray-200 shadow-sm">
          <label class="block text-base font-bold text-gray-800 mb-4 flex items-center">
            <span class="text-blue-500 mr-2">ğŸ’¬</span>
            4. ì‘ë‹µ ì†ë„
          </label>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
            {% for choice in form.response_speed %}
              <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-blue-50 hover:border-blue-300 cursor-pointer transition-all">
                {{ choice.tag }}
                <span class="ml-3 text-sm font-medium text-gray-700">{{ choice.choice_label }}</span>
              </label>
            {% endfor %}
          </div>
        </div>

        <!-- âœ… 5. ë©”ì‹œì§€/ë§íˆ¬ -->
        <div class="bg-white p-5 rounded-xl border border-gray-200 shadow-sm">
          <label class="block text-base font-bold text-gray-800 mb-4 flex items-center">
            <span class="text-blue-500 mr-2">ğŸ˜Š</span>
            5. ë©”ì‹œì§€/ë§íˆ¬
          </label>
          <div class="space-y-2">
            {% for choice in form.politeness %}
              <label class="flex items-center p-3 rounded-lg border border-gray-200 hover:bg-blue-50 hover:border-blue-300 cursor-pointer transition-all">
                {{ choice.tag }}
                <span class="ml-3 text-sm font-medium text-gray-700">{{ choice.choice_label }}</span>
              </label>
            {% endfor %}
          </div>
        </div>

        <!-- âœ… 6. ì¬ê±°ë˜ ì˜ì‚¬ (ë²„íŠ¼í˜•) -->
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-200 mb-8">
          <label class="block text-base font-bold text-gray-800 mb-6 text-center flex items-center justify-center">
            <span class="text-red-500 mr-2">ğŸ’</span>
            6. ì¬ê±°ë˜ ì˜ì‚¬
          </label>
          <div class="flex gap-4">
            <label class="flex-1 cursor-pointer">
              <input type="radio" name="deal_again" value="O" class="sr-only">
              <div class="deal-button bg-white p-6 rounded-xl border-2 border-gray-200 text-center hover:border-green-400 transition-all duration-300 hover:shadow-md">
                <div class="text-4xl mb-3">ğŸ˜</div>
                <div class="font-semibold text-gray-800 mb-1">ë„¤, ì¢‹ì•„ìš”!</div>
                <div class="text-xs text-gray-500">ì¬ê±°ë˜ í¬ë§</div>
              </div>
            </label>
            
            <label class="flex-1 cursor-pointer">
              <input type="radio" name="deal_again" value="X" class="sr-only">
              <div class="deal-button bg-white p-6 rounded-xl border-2 border-gray-200 text-center hover:border-orange-400 transition-all duration-300 hover:shadow-md">
                <div class="text-4xl mb-3">ğŸ˜…</div>
                <div class="font-semibold text-gray-800 mb-1">ê¸€ì„ìš”...</div>
                <div class="text-xs text-gray-500">ì¬ê±°ë˜ ê³ ë¯¼</div>
              </div>
            </label>
          </div>
        </div>

        <!-- âœ… ì œì¶œ ë²„íŠ¼ -->
        <div class="text-center pt-8">
          <button type="submit" class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-bold py-4 px-12 rounded-xl hover:from-blue-600 hover:to-indigo-700 transform hover:scale-105 transition-all duration-200 shadow-lg">
            âœ¨ ë¦¬ë·° ì œì¶œí•˜ê¸°
          </button>
        </div>
      </form>
    </div>

    <!-- ë‚´ ë¦¬ë·° ë³´ê¸° ì˜ì—­ -->
    <div id="tab-written" class="tab-content hidden space-y-6">
      {% for r in reviews %}
      <div class="p-4 border rounded shadow">
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center space-x-3">
            <img src="{{ r.user.profile_image.url }}" alt="ë¦¬ë·°ì–´" class="w-8 h-8 rounded-full object-cover">
            <div>
              <p class="font-medium text-sm">
                {% if r.user.first_name %}
                  {{ r.user.first_name }}
                {% elif r.user.last_name %}
                  {{ r.user.last_name }}
                {% elif r.user.username|length > 20 %}
                  ë‹‰ë„¤ì„ ë¯¸ì„¤ì •
                {% else %}
                  {{ r.user.username }}
                {% endif %}
              </p>
              <p class="text-xs text-gray-500">{{ r.created_at|date:"y/m/d A g:i" }}</p>
            </div>
          </div>
          <div class="text-yellow-500 font-semibold">
            {% for i in ""|ljust:r.rating %}â˜…{% endfor %}
            <span class="text-gray-600 text-sm ml-1">({{ r.rating }}ì )</span>
          </div>
        </div>
        
        <div class="grid grid-cols-2 gap-2 text-sm">
          <div class="bg-gray-50 px-3 py-2 rounded">
            <span class="font-medium text-gray-700">ì•½ì† ì‹œê°„:</span>
            <span class="text-gray-600">{{ r.punctuality }}</span>
          </div>
          <div class="bg-gray-50 px-3 py-2 rounded">
            <span class="font-medium text-gray-700">ìƒí’ˆ ìƒíƒœ:</span>
            <span class="text-gray-600">{{ r.description_match }}</span>
          </div>
          <div class="bg-gray-50 px-3 py-2 rounded">
            <span class="font-medium text-gray-700">ì‘ë‹µ ì†ë„:</span>
            <span class="text-gray-600">{{ r.response_speed }}</span>
          </div>
          <div class="bg-gray-50 px-3 py-2 rounded">
            <span class="font-medium text-gray-700">ë©”ì‹œì§€ ë§íˆ¬:</span>
            <span class="text-gray-600">{{ r.politeness }}</span>
          </div>
        </div>
        
        <div class="mt-3 pt-3 border-t border-gray-100">
          <span class="text-sm font-medium text-gray-700">ì¬ê±°ë˜ ì˜ì‚¬:</span>
          <span class="text-sm text-gray-600 ml-2">
            {% if r.deal_again == 'O' %}
              âœ… ì¬ê±°ë˜ í•˜ê³  ì‹¶ì–´ìš”
            {% else %}
              âŒ ì¬ê±°ë˜ëŠ” ì–´ë ¤ìš¸ ê²ƒ ê°™ì•„ìš”
            {% endif %}
          </span>
        </div>
      </div>
      {% empty %}
      <div class="text-center py-12">
        <img src="{% static 'image/ddok_black.png' %}" alt="ë¦¬ë·° ì—†ìŒ" class="w-16 h-16 mx-auto mb-4 opacity-50" />
        <p class="text-sm text-gray-500">ì•„ì§ ì‘ì„±ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
      </div>
      {% endfor %}
    </div>
  </div>
</div>

  
<style>
  /* ë³„ì  ìŠ¤íƒ€ì¼ */
  .star.active {
    color: #fbbf24 !important;
  }
  
  /* ë¼ë””ì˜¤ ë²„íŠ¼ ìˆ¨ê¸°ê¸° */
  input[type="radio"] {
    appearance: none;
    width: 16px;
    height: 16px;
    border: 2px solid #d1d5db;
    border-radius: 50%;
    position: relative;
    background: white;
    transition: all 0.2s ease;
  }
  
  input[type="radio"]:checked {
    border-color: #3b82f6;
    background: #3b82f6;
  }
  
  input[type="radio"]:checked::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: white;
  }
  
  /* ì¬ê±°ë˜ ì˜ì‚¬ ë²„íŠ¼í˜• ìŠ¤íƒ€ì¼ */
  input[type="radio"]:checked + .deal-button {
    border-color: #10b981 !important;
    background: linear-gradient(135deg, #d1fae5, #a7f3d0) !important;
    transform: translateY(-2px) !important;
    box-shadow: 0 8px 25px rgba(16, 185, 129, 0.2) !important;
  }
  
  /* í˜¸ë²„ íš¨ê³¼ ê°•í™” */
  label:hover input[type="radio"] {
    border-color: #6b7280;
  }
</style>

<script>
  // ë³„ì  ê¸°ëŠ¥
  document.addEventListener('DOMContentLoaded', function() {
    const stars = document.querySelectorAll('.star');
    const ratingInput = document.querySelector('input[name="rating"]');
    const ratingText = document.getElementById('rating-text');
    
    const ratingTexts = {
      1: 'ğŸ˜ ë³„ë¡œì˜ˆìš” (1ì )',
      2: 'ğŸ™ ì•„ì‰¬ì›Œìš” (2ì )', 
      3: 'ğŸ˜ ë³´í†µì´ì—ìš” (3ì )',
      4: 'ğŸ˜Š ì¢‹ì•„ìš”! (4ì )',
      5: 'ğŸ¤© ìµœê³ ì˜ˆìš”! (5ì )'
    };
    
    stars.forEach((star, index) => {
      star.addEventListener('click', (e) => {
        e.preventDefault();
        const rating = index + 1;
        
        // íˆë“  inputì— ê°’ ì„¤ì •
        ratingInput.value = rating;
        
        // ë³„ì  ì‹œê°ì  ì—…ë°ì´íŠ¸
        stars.forEach((s, i) => {
          if (i <= index) {
            s.classList.add('active');
          } else {
            s.classList.remove('active');
          }
        });
        
        // í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        ratingText.textContent = ratingTexts[rating];
      });
      
      // í˜¸ë²„ íš¨ê³¼
      star.addEventListener('mouseenter', () => {
        stars.forEach((s, i) => {
          if (i <= index) {
            s.style.color = '#fbbf24';
          } else {
            s.style.color = '#d1d5db';
          }
        });
      });
    });
    
    // ë§ˆìš°ìŠ¤ ë‚˜ê°ˆ ë•Œ ì›ë˜ ìƒíƒœë¡œ
    document.querySelector('.rating-stars').addEventListener('mouseleave', () => {
      stars.forEach((s, i) => {
        if (s.classList.contains('active')) {
          s.style.color = '#fbbf24';
        } else {
          s.style.color = '#d1d5db';
        }
      });
    });
    
    // í¼ ì œì¶œ ì „ ê²€ì¦
    document.getElementById('reviewForm').addEventListener('submit', (e) => {
      if (!ratingInput.value) {
        e.preventDefault();
        alert('ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”!');
        document.querySelector('.rating-stars').scrollIntoView({ behavior: 'smooth' });
      }
    });
  });

  // íƒ­ ì „í™˜ ê¸°ëŠ¥
  function showTab(tab) {
    document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
    document.getElementById('tab-' + tab).classList.remove('hidden');

    // íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.classList.remove('text-blue-600', 'font-semibold', 'border-b-2', 'border-blue-500');
      btn.classList.add('text-gray-500');
    });
    event.target.classList.add('text-blue-600', 'font-semibold', 'border-b-2', 'border-blue-500');
    event.target.classList.remove('text-gray-500');
  }
</script>
{% endblock %}