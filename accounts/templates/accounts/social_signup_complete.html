{% extends 'base.html' %}
{% load static %}

{% block body %}
<div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center px-4 py-12">
  <div class="w-full max-w-md">
    
    <!-- í™˜ì˜ ë©”ì‹œì§€ -->
    <div class="text-center mb-8">
      <div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6">
        <span class="text-3xl text-white">ğŸ‰</span>
      </div>
      <h1 class="text-3xl font-bold text-gray-800 mb-3">í™˜ì˜í•©ë‹ˆë‹¤!</h1>
      <p class="text-gray-600 leading-relaxed">
        {% if user.username|slice:":11" == "temp_kakao_" %}
          ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.<br>
        {% elif user.username|slice:":11" == "temp_naver_" %}
          ë„¤ì´ë²„ ë¡œê·¸ì¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.<br>
        {% endif %}
        í”„ë¡œí•„ì„ ì„¤ì •í•´ì„œ ì–´ë•í•´ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”!
      </p>
    </div>

    <!-- í”„ë¡œí•„ ì„¤ì • í¼ -->
    <div class="bg-white rounded-3xl shadow-xl p-8 border border-gray-100">
      
      <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
      {% if form.errors %}
        <div class="bg-red-50 border border-red-200 rounded-2xl p-4 mb-6">
          {% for field, errors in form.errors.items %}
            {% for error in errors %}
              <p class="text-red-700 text-sm">{{ error }}</p>
            {% endfor %}
          {% endfor %}
        </div>
      {% endif %}

      <form method="POST" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}

        <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
        <div class="text-center">
          <label class="block text-sm font-semibold text-gray-700 mb-4">í”„ë¡œí•„ ì´ë¯¸ì§€</label>
          
          <!-- ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° -->
          <div class="relative inline-block">
            <div class="w-24 h-24 rounded-full bg-gray-200 overflow-hidden border-4 border-white shadow-lg cursor-pointer hover:shadow-xl transition-shadow" 
                 onclick="document.getElementById('profile-image-input').click()">
              <img id="image-preview" 
                   src="{% static 'image/ddok_logo.png' %}" 
                   alt="í”„ë¡œí•„ ë¯¸ë¦¬ë³´ê¸°" 
                   class="w-full h-full object-cover">
            </div>
            
            <!-- ì¹´ë©”ë¼ ì•„ì´ì½˜ -->
            <div class="absolute bottom-0 right-0 w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center border-2 border-white cursor-pointer hover:bg-blue-600 transition-colors"
                 onclick="document.getElementById('profile-image-input').click()">
              <span class="text-white text-sm">ğŸ“·</span>
            </div>
          </div>
          
          {{ form.profile_image }}
          <p class="text-xs text-gray-500 mt-2">{{ form.profile_image.help_text }}</p>
        </div>

        <!-- ë‹‰ë„¤ì„ ì…ë ¥ -->
        <div>
          <label for="{{ form.username.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
            {{ form.username.label }} <span class="text-red-500">*</span>
          </label>
          {{ form.username }}
          {% if form.username.errors %}
            <div class="text-red-500 text-sm mt-1">
              {% for error in form.username.errors %}
                <p>{{ error }}</p>
              {% endfor %}
            </div>
          {% endif %}
          <p class="text-xs text-gray-500 mt-1">{{ form.username.help_text }}</p>
        </div>

        <!-- ìê¸°ì†Œê°œ -->
        <div>
          <label for="{{ form.bio.id_for_label }}" class="block text-sm font-semibold text-gray-700 mb-2">
            {{ form.bio.label }}
          </label>
          {{ form.bio }}
          <div class="flex justify-between items-center mt-1">
            <p class="text-xs text-gray-500">{{ form.bio.help_text }}</p>
            <span id="bio-count" class="text-xs text-gray-400 font-mono">0/150</span>
          </div>
        </div>

        <!-- ì•ˆë‚´ ë©”ì‹œì§€ -->
        <div class="bg-blue-50 border border-blue-200 rounded-2xl p-6 mb-8">
          <div class="flex items-start space-x-3">
            <div class="text-xl">ğŸ’¡</div>
            <div>
              <h4 class="font-semibold text-blue-800 mb-3">í”„ë¡œí•„ ì„¤ì • ì•ˆë‚´</h4>
              <ul class="text-sm text-blue-700 space-y-2 leading-relaxed">
                <li class="flex items-start space-x-2">
                  <span class="text-blue-500 mt-1">â€¢</span>
                  <span>ë‹‰ë„¤ì„ì€ ë‹¤ë¥¸ ì‚¬ìš©ìë“¤ì—ê²Œ í‘œì‹œë˜ëŠ” ì´ë¦„ì…ë‹ˆë‹¤.</span>
                </li>
                <li class="flex items-start space-x-2">
                  <span class="text-blue-500 mt-1">â€¢</span>
                  <span>í”„ë¡œí•„ ì´ë¯¸ì§€ëŠ” ì„ íƒì‚¬í•­ì´ì§€ë§Œ ì„¤ì •í•˜ì‹œë©´ ë” ì¹œê·¼í•´ ë³´ì—¬ìš”.</span>
                </li>
                <li class="flex items-start space-x-2">
                  <span class="text-blue-500 mt-1">â€¢</span>
                  <span>ë‚˜ì¤‘ì— ë§ˆì´í˜ì´ì§€ì—ì„œ ì–¸ì œë“  ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- ë²„íŠ¼ ê·¸ë£¹ -->
        <div class="flex justify-center pt-4">
          <button type="submit" 
                  class="w-full px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold rounded-2xl transition-all duration-200 transform hover:scale-105 shadow-lg">
            í”„ë¡œí•„ ì™„ì„±í•˜ê³  ì‹œì‘í•˜ê¸°
          </button>
        </div>
      </form>
    </div>

    <!-- í•˜ë‹¨ ë§í¬ -->
    <div class="text-center mt-8">
      <p class="text-sm text-gray-500">
        ë¬¸ì œê°€ ìˆë‚˜ìš”? 
        <a href="{% url 'accounts:logout' %}" class="text-blue-600 hover:text-blue-800 font-medium underline">
          ë‹¤ì‹œ ë¡œê·¸ì¸í•˜ê¸°
        </a>
      </p>
    </div>
  </div>
</div>

<script>
  // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
  document.getElementById('profile-image-input').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const preview = document.getElementById('image-preview');
    
    if (file && file.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = function(e) {
        preview.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  });

  // í¼ ì œì¶œ ì‹œ ê²€ì¦
  document.querySelector('form').addEventListener('submit', function(e) {
    const username = document.getElementById('{{ form.username.id_for_label }}').value.trim();
    
    if (!username) {
      e.preventDefault();
      alert('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
      document.getElementById('{{ form.username.id_for_label }}').focus();
      return false;
    }
    
    if (username.length < 2) {
      e.preventDefault();
      alert('ë‹‰ë„¤ì„ì€ ìµœì†Œ 2ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”!');
      document.getElementById('{{ form.username.id_for_label }}').focus();
      return false;
    }
  });
</script>

{% endblock %}