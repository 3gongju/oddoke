{% load static %}
{% load member_images %}

<style>
/* 모든 생일 아티스트 인디케이터 통일 스타일 */

/* 템플릿 기반 인디케이터 (#indicators) */
#indicators button,
#indicators .indicator-dot,
#indicators .w-\[5px\] {
    width: 6px !important;
    height: 6px !important;
    margin: 0 3px !important;
}

/* JavaScript 기반 인디케이터 (#birthdayIndicators) */
#birthdayIndicators button,
#birthdayIndicators .w-1,
#birthdayIndicators .w-2 {
    width: 6px !important;
    height: 6px !important;
    margin: 0 3px !important;
}

/* 모든 생일 관련 인디케이터 */
[id*="birthday"] button,
[id*="indicator"] button {
    min-width: 6px !important;
    min-height: 6px !important;
    max-width: 6px !important;
    max-height: 6px !important;
}

/* 호버 효과 */
#indicators button:hover,
#birthdayIndicators button:hover {
    transform: scale(1.3);
    transition: transform 0.2s ease;
}

/* 모바일 최적화 */
@media (max-width: 768px) {
    #indicators button,
    #birthdayIndicators button {
        width: 6px !important;
        height: 6px !important;
        margin: 0 2px !important;
    }
}
</style>

<div class="max-w-7xl mx-auto"> 
  {% if birthday_artists %}
    <div class="relative">
      <div class="overflow-hidden">
        <div id="birthdaySlider" class="flex transition-transform duration-500 ease-in-out">
          {% for artist in birthday_artists %}
            <div class="flex-shrink-0 w-full sm:w-1/2 md:w-1/3 lg:w-1/4 xl:w-1/5 px-1.5">
              <div class="{% if artist.is_today_birthday %}bg-pink-400 bg-opacity-20 backdrop-blur-sm{% else %}bg-white{% endif %} 
                          rounded-lg p-3 text-center cursor-pointer hover:shadow"
                   onclick="searchArtist('{{ artist.member_name }}')">

                <!-- 상단 라벨 -->
                {% if artist.is_today_birthday %}
                  <div class="mb-2">
                    <span class="bg-black text-white text-xs px-2 py-0.5 rounded-full font-bold">
                      오늘 생일!
                    </span>
                  </div>
                {% else %}
                  <div class="h-4 mb-2"></div>
                {% endif %}

                <!-- 프로필 이미지 - 크기 축소 -->
                <div class="flex justify-center mb-2">
                  <img src="{% member_image artist.member_name artist.artist_display_name %}"
                       alt="{{ artist.member_name }}"
                       class="w-16 h-16 sm:w-20 sm:h-20 rounded-full object-cover border-2 border-white">
                </div>

                <!-- 텍스트 정보 - 크기 축소 -->
                <div class="flex flex-col items-center">
                  <h3 class="font-semibold text-xs sm:text-sm text-gray-800 truncate">
                    {{ artist.member_name }}
                  </h3>
                  {% if artist.artist_name %}
                    <p class="text-xs text-gray-500 truncate">{{ artist.artist_name }}</p>
                  {% endif %}
                  <p class="text-xs mt-0.5 text-gray-600">
                    {{ artist.birthday_display }}
                  </p>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>

      <!-- 네비게이션 - 크기 축소 -->
      <button id="birthdayPrevBtn" class="absolute left-1 top-1/2 -translate-y-1/2 z-10
                                          bg-white border border-gray-300 rounded-full p-1.5
                                          hover:bg-gray-50 transition disabled:opacity-50">
        <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
      </button>
      <button id="birthdayNextBtn" class="absolute right-1 top-1/2 -translate-y-1/2 z-10
                                          bg-white border border-gray-300 rounded-full p-1.5
                                          hover:bg-gray-50 transition disabled:opacity-50">
        <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </button>

      <!-- 인디케이터 -->
      <div class="flex justify-center mt-4 space-x-2" id="birthdayIndicators">
        <!-- JS 생성 -->
      </div>
    </div>
  {% else %}
    <!-- 빈 상태 - 크기 축소 -->
    <div class="text-center py-6 sm:py-8">
      <div class="w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-3 sm:mb-4">
        <img src="{% static 'image/ddok_logo_filled.png' %}" alt="이번 주 생일인 아티스트 없음" class="w-full h-full object-contain" />
      </div>
      <p class="font-heading text-base sm:text-lg font-light text-black mb-2">이번 주 생일인 아티스트가 없어요</p>
      <p class="text-gray-400 text-xs sm:text-sm mt-1 font-body">다음 주를 기대해주세요!</p>
    </div>
  {% endif %}
</div>

<!-- 생일 아티스트 슬라이더 스크립트 -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  setTimeout(initBirthdaySlider, 0);
});

function initBirthdaySlider() {
  const slider = document.getElementById('birthdaySlider');
  const prevBtn = document.getElementById('birthdayPrevBtn');
  const nextBtn = document.getElementById('birthdayNextBtn');
  const indicatorsContainer = document.getElementById('birthdayIndicators');
  
  if (!slider) return;
  
  const slides = slider.children;
  let currentIndex = 0;
  let itemsPerView = getItemsPerView();
  let totalPages = Math.ceil(slides.length / itemsPerView);

  function getItemsPerView() {
    if (window.innerWidth >= 1280) return 5;
    if (window.innerWidth >= 1024) return 4;
    if (window.innerWidth >= 768) return 3;
    if (window.innerWidth >= 640) return 2;
    return 1;
  }

  function createIndicators() {
    if (!indicatorsContainer) return;
    indicatorsContainer.innerHTML = '';
    for (let i = 0; i < totalPages; i++) {
      const dot = document.createElement('button');
      dot.className = `w-1 h-1 rounded-full transition-colors mx-1 ${i === 0 ? 'bg-gray-800' : 'bg-gray-300'}`;
      dot.onclick = () => goToPage(i);
      indicatorsContainer.appendChild(dot);
    }
  }

  function goToPage(pageIndex) {
    currentIndex = Math.max(0, Math.min(pageIndex, totalPages - 1));
    const translateX = -(currentIndex * 100);
    slider.style.transform = `translateX(${translateX}%)`;
    updateButtons();
    updateIndicators();
  }

  function updateButtons() {
    if (prevBtn) prevBtn.disabled = currentIndex === 0;
    if (nextBtn) nextBtn.disabled = currentIndex >= totalPages - 1;
  }

  function updateIndicators() {
    if (!indicatorsContainer) return;
    const dots = indicatorsContainer.children;
    for (let i = 0; i < dots.length; i++) {
      dots[i].className = `w-1 h-1 rounded-full transition-colors mx-1 ${i === currentIndex ? 'bg-gray-800' : 'bg-gray-300'}`;
    }
  }

  if (prevBtn) {
    prevBtn.addEventListener('click', () => goToPage(currentIndex - 1));
  }

  if (nextBtn) {
    nextBtn.addEventListener('click', () => goToPage(currentIndex + 1));
  }

  window.addEventListener('resize', () => {
    const newItemsPerView = getItemsPerView();
    if (newItemsPerView !== itemsPerView) {
      itemsPerView = newItemsPerView;
      totalPages = Math.ceil(slides.length / itemsPerView);
      createIndicators();
      goToPage(0);
    }
  });

  createIndicators();
  updateButtons();
}
</script>