{% extends "ddoksang/base/ddoksang_base.html" %}
{% load static %}
{% load filters %}

{% block title %}ë‚´ ì°œ ëª©ë¡ - ë•ìƒ{% endblock %}

{% block body %}
<section class="max-w-7xl mx-auto px-4 py-10" id="favoritesSection">
  <div class="flex items-center justify-between mb-6">
    <div>
      <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2">ğŸ’• ë‚´ê°€ ì°œí•œ ë•ì˜ ìƒì¹´</h2>
      <p class="text-gray-600 text-sm sm:text-base">ì°œí•œ ì•„í‹°ìŠ¤íŠ¸/ë©¤ë²„ë“¤ì˜ ìƒì¼ì¹´í˜ë¥¼ ëª¨ì•„ë´¤ì–´ìš”!</p>
    </div>
    <a href="{% url 'ddoksang:home' %}" class="text-pink-600 hover:underline text-sm sm:text-base">í™ˆìœ¼ë¡œ &rarr;</a>
  </div>

  {% if favorites %}
    <div id="favoriteCarousel" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6">
      {% for favorite in favorites %}
        <div class="flex-shrink-0" data-cafe-id="{{ favorite.cafe.id }}">
          {% include 'ddoksang/components/_cafe_card.html' with cafe=favorite.cafe show_favorite_btn=True user_favorites=user_favorites %}
        </div>
      {% endfor %}
    </div>
    
    <!-- ì´ ê°œìˆ˜ í‘œì‹œ -->
    <div class="mt-8 text-center">
      <p class="text-sm text-gray-500">ì´ {{ favorites.count }}ê°œì˜ ìƒì¼ì¹´í˜ë¥¼ ì°œí–ˆì–´ìš”</p>
    </div>
  {% else %}
    <div class="text-center py-16">
      <div class="text-6xl mb-4">ğŸ’”</div>
      <h3 class="text-lg font-medium text-gray-900 mb-2">ì•„ì§ ì°œí•œ ìƒì¼ì¹´í˜ê°€ ì—†ì–´ìš”</h3>
      <p class="text-gray-600 mb-6">ë§ˆìŒì— ë“œëŠ” ìƒì¹´ë¥¼ ì°œí•´ë³´ì„¸ìš”!</p>
      <a href="{% url 'ddoksang:home' %}" class="inline-block bg-pink-600 text-white px-6 py-3 rounded-lg hover:bg-pink-700 transition-colors">
        ìƒì¼ì¹´í˜ ë‘˜ëŸ¬ë³´ê¸°
      </a>
    </div>
  {% endif %}
</section>

<!-- CSRF í† í° -->
{% csrf_token %}

<!-- í†µí•© ì°œí•˜ê¸° ì‹œìŠ¤í…œ ë¡œë“œ -->
<!-- <script src="{% static 'js/favorite.js' %}"></script> -->

<!-- í˜ì´ì§€ë³„ ì´ˆê¸°í™” -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // ì°œí•˜ê¸° ìƒíƒœ ë³€ê²½ ì½œë°± ë“±ë¡
    if (window.favoriteManager) {
        window.favoriteManager.onFavoriteChange((cafeId, isFavorited) => {
            console.log(`ì¹´í˜ ${cafeId} ì°œí•˜ê¸° ìƒíƒœ ë³€ê²½: ${isFavorited}`);
            
            // ì°œ í•´ì œ ì‹œ í˜ì´ì§€ì—ì„œ í•´ë‹¹ ì¹´ë“œ ì œê±°
            if (!isFavorited) {
                const card = document.querySelector(`[data-cafe-id="${cafeId}"]`);
                if (card) {
                    card.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                    card.style.opacity = '0';
                    card.style.transform = 'scale(0.8)';
                    
                    setTimeout(() => {
                        card.remove();
                        
                        // ì¹´ë“œê°€ ëª¨ë‘ ì œê±°ë˜ë©´ ë¹ˆ ìƒíƒœ í‘œì‹œ
                        const carousel = document.getElementById('favoriteCarousel');
                        if (carousel && carousel.children.length === 0) {
                            window.location.reload(); // ë¹ˆ ìƒíƒœ UIë¡œ ìƒˆë¡œê³ ì¹¨
                        }
                    }, 300);
                }
            }
        });
    }
});
</script>
{% endblock %}