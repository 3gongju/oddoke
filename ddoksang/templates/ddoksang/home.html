
{% extends "base.html" %}
{% load static %}
{% load filters %}
{% load member_images %}

{% block title %}🎂 덕생 - 생일카페 투어맵{% endblock %}

{% block body %}
<!-- ✅ 데이터 스크립트 -->
{% csrf_token %}
{{ cafes_json|json_script:"cafes-data" }}
<script id="user-favorites-data" type="application/json">{{ user_favorites|safe }}</script>

<!-- ✅ 위치 동의 모달 -->
<div id="locationModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
  <div class="bg-white rounded-2xl p-6 sm:p-8 max-w-md w-full mx-4 shadow-2xl">
    <div class="text-center">
      <div class="w-12 h-12 sm:w-16 sm:h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
        <svg class="w-6 h-6 sm:w-8 sm:h-8 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
      </div>
      <h2 class="text-lg sm:text-xl font-bold text-gray-900 mb-2">위치 정보 사용 동의</h2>
      <p class="text-sm sm:text-base text-gray-600 mb-6 leading-relaxed">
        내 주변의 생일카페를 찾기 위해<br>위치 정보를 사용합니다.
      </p>
      <div class="space-y-3">
        <button id="allowLocationBtn" class="w-full bg-gray-900 text-white py-2.5 sm:py-3 px-4 sm:px-6 rounded-lg font-semibold hover:bg-gray-800 transition-all text-sm sm:text-base">위치 정보 허용</button>
        <button id="denyLocationBtn" class="w-full bg-gray-100 text-gray-700 py-2.5 sm:py-3 px-4 sm:px-6 rounded-lg font-medium hover:bg-gray-200 text-sm sm:text-base">거부하고 기본 지도</button>
      </div>
      <p class="text-xs text-gray-500 mt-4">위치 정보는 검색에만 사용되며 저장되지 않습니다.</p>
    </div>
  </div>
</div>

<!-- ✅ 상단 검색 헤더 -->
{% include "ddoksang/components/_ddoksang_header.html" %}

<!-- ✅ 메인 콘텐츠 -->
<div class="max-w-7xl mx-auto">

  <!-- ✅ 생일 아티스트 캐러셀 -->
  {% include "ddoksang/components/_artist_carousel.html" %}

  <!-- ✅ 내가 찜한 생카 캐러셀 -->
  {% if user.is_authenticated and my_favorite_cafes %}
    {% include "ddoksang/components/_cafe_card_list.html" with cafes=my_favorite_cafes section_title="💖 내가 찜한 덕의 생카" empty_message="찜한 생카가 없습니다." %}
  {% endif %}

  <!-- ✅ 최신 생일카페 카드 리스트 -->
  {% include "ddoksang/components/_cafe_card_list.html" with cafes=latest_cafes section_title="🆕 최신 생일카페" empty_message="아직 등록된 생카가 없습니다." %}
</div>

<!-- ✅ 생카 모달 (지도용) -->


<!-- ✅ 플로팅 버튼 -->
{% include "ddoksang/components/_floating_button.html" %}

<!-- ✅ 자바스크립트 모듈 로드 -->
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey={{ KAKAO_MAP_API_KEY }}&libraries=services,clusterer"></script>
{% include "ddoksang/components/_javascript_modules.html" %}
<script src="{% static 'js/maps.js' %}"></script>

{% endblock %}
\