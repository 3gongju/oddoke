{% extends "base.html" %}
{% load static %}
{% load filters %}

{% block title %}ë‚´ ë“±ë¡ ì¹´í˜ - ë•ìƒ{% endblock %}

{% block body %}
<section class="max-w-7xl mx-auto px-4 py-10">
  <h2 class="text-2xl font-bold mb-6">ğŸ“‹ ë‚´ê°€ ë“±ë¡í•œ ìƒì¼ì¹´í˜</h2>

  <script src="{% static 'js/autocomplete.js' %}"></script>

  <!-- âœ… ê²€ìƒ‰ í—¤ë” ì»´í¬ë„ŒíŠ¸ -->
  {% include 'ddoksang/components/_search_header.html' with 
      search_placeholder='ë‚´ ë“±ë¡ ì¹´í˜ì—ì„œ ì•„í‹°ìŠ¤íŠ¸/ë©¤ë²„ ê²€ìƒ‰...' 
      search_url=request.path 
      query=request.GET.q 
      action_buttons=action_buttons_data 
      filter_tags=status_filters 
      search_input_id='my-cafes-search' 
      autocomplete_list_id='my-cafes-autocomplete' 
      autocomplete_options=autocomplete_config %}

  <!-- âœ… í†µê³„ ë° í•„í„° ì˜ì—­ -->
  <div class="py-6">
    <div class="mb-6">
      <p class="text-gray-600">ë“±ë¡í•œ ìƒì¼ì¹´í˜ë¥¼ ê´€ë¦¬í•˜ê³  í˜„í™©ì„ í™•ì¸í•˜ì„¸ìš”</p>
    </div>

    <!-- í†µê³„ ì¹´ë“œ -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center">
        <div class="text-2xl font-bold text-blue-600">{{ stats.total }}</div>
        <div class="text-sm text-blue-600">ì´ ë“±ë¡</div>
      </div>
      <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center">
        <div class="text-2xl font-bold text-yellow-600">{{ stats.pending }}</div>
        <div class="text-sm text-yellow-600">ìŠ¹ì¸ ëŒ€ê¸°</div>
      </div>
      <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-center">
        <div class="text-2xl font-bold text-green-600">{{ stats.approved }}</div>
        <div class="text-sm text-green-600">ìŠ¹ì¸ë¨</div>
      </div>
      <div class="bg-red-50 border border-red-200 rounded-lg p-4 text-center">
        <div class="text-2xl font-bold text-red-600">{{ stats.rejected }}</div>
        <div class="text-sm text-red-600">ê±°ì ˆë¨</div>
      </div>
    </div>

    <!-- ìŠ¹ì¸ ìƒíƒœ í•„í„° -->
    {% if status_filters %}
      <div class="mb-6 border-b border-gray-200">
        <nav class="flex space-x-8">
          {% for filter in status_filters %}
            <a href="{{ filter.url }}"
               class="py-2 px-1 border-b-2 font-medium text-sm transition-colors {{ filter.active|yesno:'border-blue-500 text-blue-600,border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300' }}">
              {{ filter.text }}
            </a>
          {% endfor %}
        </nav>
      </div>
    {% endif %}

    <!-- ì¼ì • ìƒíƒœ í•„í„° -->
    {% if runtime_filters %}
      <div class="mb-6 border-b border-gray-100">
        <nav class="flex space-x-4">
          {% for filter in runtime_filters %}
            <a href="{{ filter.url }}"
               class="py-1.5 px-3 rounded-full text-sm border transition
               {% if filter.active %}
                 bg-black text-white border-black
               {% else %}
                 bg-white text-gray-600 border-gray-300 hover:bg-gray-100
               {% endif %}">
              {{ filter.text }}
            </a>
          {% endfor %}
        </nav>
      </div>
    {% endif %}
  </div>

  <!-- âœ… ì¹´í˜ ëª©ë¡ -->
  <div class="pb-10">
    {% if cafes %}
      <!-- ì •ë ¬ ì˜µì…˜ -->
      <div class="flex justify-between items-center mb-6">
        <div class="text-sm text-gray-600">
          {% if request.GET.q %}
            "{{ request.GET.q }}" ê²€ìƒ‰ ê²°ê³¼ {{ cafes.paginator.count }}ê°œ
          {% else %}
            ì´ {{ cafes.paginator.count }}ê°œì˜ ìƒì¼ì¹´í˜
          {% endif %}
        </div>
        <div class="flex items-center space-x-2">
          <span class="text-sm text-gray-600">ì •ë ¬:</span>
          <select class="text-sm border rounded px-2 py-1" onchange="location.href=this.value">
            <option value="?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}{% if request.GET.status %}status={{ request.GET.status }}&{% endif %}{% if request.GET.runtime %}runtime={{ request.GET.runtime }}&{% endif %}sort=latest" {% if request.GET.sort == 'latest' or not request.GET.sort %}selected{% endif %}>ìµœì‹ ìˆœ</option>
            <option value="?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}{% if request.GET.status %}status={{ request.GET.status }}&{% endif %}{% if request.GET.runtime %}runtime={{ request.GET.runtime }}&{% endif %}sort=oldest" {% if request.GET.sort == 'oldest' %}selected{% endif %}>ì˜¤ë˜ëœìˆœ</option>
            <option value="?{% if request.GET.q %}q={{ request.GET.q }}&{% endif %}{% if request.GET.status %}status={{ request.GET.status }}&{% endif %}{% if request.GET.runtime %}runtime={{ request.GET.runtime }}&{% endif %}sort=start_date" {% if request.GET.sort == 'start_date' %}selected{% endif %}>ì‹œì‘ì¼ìˆœ</option>
          </select>
        </div>
      </div>

      {% include 'ddoksang/components/_cafe_grid.html' with cafes=cafes empty_message="ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤." %}
      {% include 'ddoksang/components/_pagination.html' with paginated_object=cafes query=request.GET.q extra_params=extra_params %}

    {% else %}
      <!-- ë¹ˆ ìƒíƒœ -->
      <div class="text-center py-12">
        <div class="text-6xl mb-4">ğŸ“</div>
        <h3 class="text-lg font-medium text-gray-900 mb-2">
          {% if request.GET.q %}ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤{% else %}ì•„ì§ ë“±ë¡í•œ ìƒì¼ì¹´í˜ê°€ ì—†ì–´ìš”{% endif %}
        </h3>
        <p class="text-gray-600 mb-6">
          {% if request.GET.q %}
            ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¡œ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.
          {% else %}
            ì²« ìƒì¼ì¹´í˜ë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”!
          {% endif %}
        </p>
        <a href="{% url 'ddoksang:create' %}" class="inline-block bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">
          + ìƒì¼ì¹´í˜ ë“±ë¡í•˜ê¸°
        </a>
      </div>
    {% endif %}
  </div>
</section>
{% endblock %}
