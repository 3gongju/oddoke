{% extends "base.html" %}
{% load static %}
{% load utils %}

{% block body %}
<section class="max-w-7xl mx-auto px-4 py-10">
  <h2 class="text-2xl font-bold mb-6">📋 내가 등록한 생일카페</h2>

  {% if cafes %}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for cafe in cafes %}
        <div class="bg-white rounded-lg shadow hover:shadow-md transition border p-4 space-y-3">
          {% if cafe.get_main_image %}
            <img src="{{ cafe.get_main_image }}" alt="{{ cafe.cafe_name }}" class="w-full h-40 object-cover rounded-md">
          {% else %}
            <div class="w-full h-40 bg-gray-100 flex items-center justify-center rounded-md">
              <span class="text-gray-400 text-3xl">🏪</span>
            </div>
          {% endif %}

          <h3 class="text-lg font-semibold truncate">{{ cafe.cafe_name }}</h3>
          <p class="text-sm text-gray-600">
            {{ cafe.artist.display_name }}{% if cafe.member %} - {{ cafe.member.member_name }}{% endif %}
          </p>
          <p class="text-sm text-gray-500">📅 {{ cafe.start_date }} ~ {{ cafe.end_date }}</p>
          <p class="text-sm text-gray-500 truncate">📍 {{ cafe.address|truncatechars:30 }}</p>

          {% if cafe.hashtags %}
            <div class="flex flex-wrap gap-1 mt-2">
              {% for tag in cafe.hashtags|split:"#" %}
                {% if tag.strip %}
                  <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full">#{{ tag.strip }}</span>
                {% endif %}
              {% endfor %}
            </div>
          {% endif %}
          

           <div class="mt-3 flex justify-between items-center">
            {% if cafe.status == 'approved' %}
              <a href="{% url 'ddoksang:detail' cafe.id %}" class="text-sm text-blue-600 hover:underline font-medium">자세히 보기 →</a>
            {% else %}
              <a href="{% url 'ddoksang:user_preview' cafe.id %}" class="text-sm text-orange-600 hover:underline font-medium">내 카페 보기 →</a>
            {% endif %} 

            <span class="text-xs px-2 py-0.5 rounded-full
              {% if cafe.status == 'approved' %}bg-green-100 text-green-700
              {% elif cafe.status == 'pending' %}bg-yellow-100 text-yellow-700
              {% elif cafe.status == 'rejected' %}bg-red-100 text-red-700
              {% else %}bg-gray-100 text-gray-700{% endif %}">
              {{ cafe.get_status_display }}
            </span>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    {% include 'ddoksang/components/_empty_message.html' with message='등록한 생일카페가 없습니다. 첫 생카를 등록해보세요!' %}
  {% endif %}
</section>
{% endblock %}
