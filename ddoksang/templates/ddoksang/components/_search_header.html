{% load static %}

<section class="py-4 sm:py-6">
  <div class="max-w-7xl mx-auto px-4">
    <!-- ğŸ”§ ìˆ˜ì •: ëª¨ë°”ì¼ì—ì„œë„ í•œ ì¤„ ë°°ì¹˜ë¥¼ ìœ„í•œ Flexbox ì¡°ì • -->
    <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 items-stretch sm:items-center">
      
      <!-- ê²€ìƒ‰ì°½ -->
      <div class="flex-1 relative">
        <form method="get" action="{% url 'ddoksang:search' %}">
          <input 
            id="{{ search_input_id|default:'main-search' }}" 
            type="text" 
            name="q" 
            placeholder="{{ search_placeholder|default:'ì•„í‹°ìŠ¤íŠ¸, ë©¤ë²„ ê²€ìƒ‰' }}" 
            class="w-full py-2.5 sm:py-3 px-4 sm:px-6 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-pink-500 text-sm sm:text-lg"
            value="{{ query|default:'' }}" 
            autocomplete="off">
          
          <button type="submit" class="absolute right-3 sm:right-4 top-1/2 transform -translate-y-1/2">
            <svg class="w-5 h-5 sm:w-6 sm:h-6 text-gray-400 hover:text-gray-600" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 104.5 4.5a7.5 7.5 0 0012.15 12.15z"/>
            </svg>
          </button>
        </form>
        
        <!-- ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ -->
        <ul id="{{ autocomplete_list_id|default:'main-autocomplete-list' }}" 
            class="absolute top-full left-0 w-full bg-white border border-gray-200 rounded-lg shadow-lg hidden max-h-48 overflow-y-auto z-50 mt-1">
        </ul>
      </div>

      <!-- ìƒì¹´ ë“±ë¡ ë²„íŠ¼ (ë°ìŠ¤í¬í†±ì—ì„œë§Œ í‘œì‹œ, ëª¨ë°”ì¼ì—ì„œëŠ” í•˜ë‹¨ FAB ì‚¬ìš©) -->
      {% if show_create_button %}
      <!-- ğŸ”§ ëª¨ë°”ì¼ì—ì„œëŠ” ìˆ¨ê¹€ (hidden), ë°ìŠ¤í¬í†±ì—ì„œë§Œ í‘œì‹œ (sm:block) -->
      <div class="hidden sm:flex flex-shrink-0">
        <a href="{% url 'ddoksang:create' %}" 
           class="bg-gray-900 text-white px-6 py-3 rounded-lg font-semibold hover:bg-gray-800 transition-all duration-200 text-base whitespace-nowrap">
          + ìƒì¹´ ë“±ë¡
        </a>
      </div>
      {% endif %}
    </div>

    <!-- ê²€ìƒ‰ ê²°ê³¼ ìš”ì•½ (ê²€ìƒ‰ í˜ì´ì§€ì—ì„œë§Œ í‘œì‹œ) -->
    {% if show_results_summary and query %}
    <div class="mt-4 text-center">
      <p class="text-lg text-gray-600">
        '<span class="font-semibold text-blue-600">{{ query }}</span>' ê²€ìƒ‰ ê²°ê³¼
        {% if total_count %}
          <span class="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded-full ml-2">
            ì´ {{ total_count }}ê°œ
          </span>
        {% endif %}
      </p>
    </div>
    {% endif %}
  </div>
</section>

<!-- ëª¨ë“  ê²€ìƒ‰ì°½ì—ì„œ ë™ì¼í•œ ì„¤ì • -->
<script src="{% static 'js/autocomplete.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const searchInputId = '{{ search_input_id|default:"main-search" }}';
  const autocompleteListId = '{{ autocomplete_list_id|default:"main-autocomplete-list" }}';

  if (typeof initAutocomplete === 'function') {
    initAutocomplete(searchInputId, autocompleteListId, {
      showBirthday: true,        // ìƒì¼ í‘œì‹œ
      showArtistTag: true,       // ì•„í‹°ìŠ¤íŠ¸/ë©¤ë²„ íƒœê·¸ í‘œì‹œ
      submitOnSelect: true,
      artistOnly: false,
      apiUrl: '/artist/autocomplete/'
    });
  }
});
</script>