{% comment %}
=====================================
_cafe_card_latest.html - ìµœì‹  ì¹´í˜ìš©
=====================================
íŠ¹ì§•:
- í° í…ìŠ¤íŠ¸ë¡œ ê°€ë…ì„± í–¥ìƒ (16px â†’ 18-20px)
- NEW ë±ƒì§€ë¡œ ìµœì‹ ì„± ê°•ì¡°
- ë„‰ë„‰í•œ íŒ¨ë”©ê³¼ ì—¬ë°±
- ê³¨ë“œ ê·¸ë¼ë””ì–¸íŠ¸ ì»¬ëŸ¬
{% endcomment %}

{% load static %}
{% load filters %}

<div class="group transform transition-all duration-300 hover:-translate-y-2 card-latest">
  <div class="bg-white rounded-3xl overflow-hidden shadow-lg group-hover:shadow-2xl transition-all duration-300 border border-gray-100">
    
    <!-- ì´ë¯¸ì§€ ì„¹ì…˜ -->
    <div class="relative h-56 overflow-hidden">
      {% if cafe.get_main_image %}
        <img src="{{ cafe.get_main_image }}" 
             alt="{{ cafe.cafe_name }}" 
             class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
             loading="lazy">
      {% else %}
        <div class="w-full h-full bg-gradient-to-br from-yellow-100 to-orange-100 flex items-center justify-center">
          <span class="text-orange-400 text-5xl">ğŸ‚</span>
        </div>
      {% endif %}
      
      <!-- NEW ë±ƒì§€ -->
      <div class="absolute top-4 left-4">
        <span class="new-badge text-white text-sm font-bold px-4 py-2 rounded-full shadow-lg flex items-center">
          â­ NEW
        </span>
      </div>
      
      <!-- ìƒíƒœ ë±ƒì§€ -->
      <div class="absolute top-4 right-4">
        {% with cafe|cafe_status as cafe_state %}
          {% if cafe_state == 'ongoing' %}
            <span class="bg-green-500 text-white text-sm font-medium px-3 py-1 rounded-full shadow-lg">âœ¨ ìš´ì˜ì¤‘</span>
          {% elif cafe_state == 'upcoming' %}
            <span class="bg-blue-500 text-white text-sm font-medium px-3 py-1 rounded-full shadow-lg">ğŸ”œ ì˜ˆì •</span>
          {% else %}
            <span class="bg-gray-500 text-white text-sm font-medium px-3 py-1 rounded-full shadow-lg">âœ… ì¢…ë£Œ</span>
          {% endif %}
        {% endwith %}
      </div>
      
      <!-- ì°œí•˜ê¸° ë²„íŠ¼ -->
      {% if user.is_authenticated and cafe.status == 'approved' %}
        <div class="absolute bottom-4 right-4">
          <button data-favorite-btn 
                  data-cafe-id="{{ cafe.id }}"
                  class="w-12 h-12 bg-white bg-opacity-90 backdrop-blur-sm rounded-full flex items-center justify-center text-xl hover:scale-110 transition-all shadow-lg"
                  style="color: {% if cafe.id in user_favorites %}#ef4444{% else %}#6b7280{% endif %};"
                  title="{% if cafe.id in user_favorites %}ì°œ í•´ì œ{% else %}ì°œí•˜ê¸°{% endif %}">
            {% if cafe.id in user_favorites %}â™¥{% else %}â™¡{% endif %}
          </button>
        </div>
      {% endif %}
    </div>
    
    <!-- ì½˜í…ì¸  ì„¹ì…˜ -->
    <div class="p-6">
      <!-- ë“±ë¡ì¼ -->
      <div class="flex items-center justify-between mb-4">
        <span class="text-sm text-orange-600 font-medium bg-orange-50 px-3 py-1 rounded-full border border-orange-200">
          {% if cafe.created_at|timesince|slice:":2" == "0ë¶„" %}
            ë°©ê¸ˆ ë“±ë¡ë¨
          {% else %}
            {{ cafe.created_at|timesince }} ì „ ë“±ë¡
          {% endif %}
        </span>
        <span class="text-sm text-gray-500">{{ cafe.created_at|date:"m.d" }}</span>
      </div>
      
      <!-- ì•„í‹°ìŠ¤íŠ¸/ë©¤ë²„ ì •ë³´ (ë” í° í…ìŠ¤íŠ¸) -->
      <h3 class="text-xl font-bold text-gray-900 mb-2">
        {% if cafe.member %}
          {{ cafe.member.member_name }} ìƒì¼ì¹´í˜
        {% else %}
          {{ cafe.artist.display_name }}
        {% endif %}
      </h3>
      <p class="text-base text-gray-600 mb-1 font-medium">
        {{ cafe.artist.display_name }}{% if cafe.member %} - {{ cafe.member.member_name }}{% endif %}
      </p>
      
      <!-- ì¹´í˜ëª… (ë” ì½ê¸° ì‰½ê²Œ) -->
      <h4 class="text-lg font-semibold text-gray-800 mb-4 leading-relaxed line-clamp-2">
        {{ cafe.cafe_name }}
      </h4>
      
      <!-- ìœ„ì¹˜ ì •ë³´ (ë” í° í…ìŠ¤íŠ¸) -->
      <div class="flex items-center text-base text-gray-600 mb-3">
        <svg class="w-5 h-5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
        </svg>
        <span class="truncate font-medium">{{ cafe.place_name|default:cafe.address|truncatechars:25 }}</span>
      </div>
      
      <!-- ê¸°ê°„ ì •ë³´ (ë” í° í…ìŠ¤íŠ¸) -->
      <div class="flex items-center text-base text-gray-600 mb-4">
        <svg class="w-5 h-5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
        </svg>
        <span class="font-semibold">{{ cafe.start_date|date:"m.d" }} - {{ cafe.end_date|date:"m.d" }}</span>
        {% if cafe.days_remaining > 0 and cafe.days_remaining <= 7 %}
          <span class="ml-3 text-red-600 font-bold text-sm bg-red-50 px-2 py-1 rounded-full">{{ cafe.days_remaining }}ì¼ ë‚¨ìŒ</span>
        {% elif cafe.days_remaining > 7 %}
          <span class="ml-3 text-blue-600 font-bold text-sm bg-blue-50 px-2 py-1 rounded-full">{{ cafe.days_remaining }}ì¼ í›„</span>
        {% endif %}
      </div>
      
      <!-- íŠ¹ì „ ë¯¸ë¦¬ë³´ê¸° (ë” ë³´ê¸° ì‰½ê²Œ) -->
      {% if cafe.special_benefits %}
        <div class="mb-5">
          <div class="flex flex-wrap gap-2">
            {% for benefit in cafe.special_benefits|split:","|slice:":3" %}
              {% if benefit|strip %}
                <span class="inline-block bg-purple-100 text-purple-700 text-sm px-3 py-1 rounded-full font-medium border border-purple-200">
                  {{ benefit|strip }}
                </span>
              {% endif %}
            {% endfor %}
            {% if cafe.special_benefits|split:","|length > 3 %}
              <span class="text-sm text-gray-500 font-medium">+{{ cafe.special_benefits|split:","|length|add:"-3" }}ê°œ</span>
            {% endif %}
          </div>
        </div>
      {% endif %}
      
      <!-- ë²„íŠ¼ (ë” í° í¬ê¸°) -->
      <a href="{% url 'ddoksang:detail' cafe.id %}" 
         class="block w-full bg-gray-900 text-white py-3 px-6 rounded-xl text-base font-semibold hover:bg-gray-800 transition-colors text-center">
        ìì„¸íˆ ë³´ê¸°
      </a>
    </div>
  </div>
</div>

<style>
/* ìµœì‹  ì¹´í˜ ì¹´ë“œ ì „ìš© ìŠ¤íƒ€ì¼ */
.card-latest .new-badge {
  background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
  box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);
}

.card-latest:hover .new-badge {
  transform: scale(1.05);
  transition: transform 0.2s ease;
}

.card-latest .line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ë°˜ì‘í˜• í…ìŠ¤íŠ¸ í¬ê¸° */
@media (max-width: 640px) {
  .card-latest h3 {
    font-size: 1.125rem; /* 18px */
  }
  
  .card-latest h4 {
    font-size: 1rem; /* 16px */
  }
  
  .card-latest .text-base {
    font-size: 0.875rem; /* 14px */
  }
  
  .card-latest .p-6 {
    padding: 1rem;
  }
}
</style>