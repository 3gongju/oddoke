{% load static %}
{% load filters %}

<!-- ğŸ”§ í…œí”Œë¦¿ ì—…ë°ì´íŠ¸ í™•ì¸ìš© -->
<div style="background: red; color: white; padding: 10px; text-align: center;">
    ğŸš¨ ìƒˆë¡œìš´ Swiper í…œí”Œë¦¿ ë¡œë“œë¨! (ì´ ë©”ì‹œì§€ê°€ ë³´ì´ë©´ ì„±ê³µ)
</div>

<section class="mb-12" id="favoritesSection">
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-xl font-semibold text-gray-800">ğŸ’– ë‚´ê°€ ì°œí•œ ìƒì¼ì¹´í˜</h2>
    <a href="{% url 'ddoksang:favorites' %}" class="text-sm text-pink-600 hover:underline">ì „ì²´ ë³´ê¸° &rarr;</a>
  </div>

  {% if my_favorite_cafes %}
    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    
    <!-- Swiper ì»¨í…Œì´ë„ˆ -->
    <div class="swiper favorites-swiper relative">
      <div class="swiper-wrapper">
        {% for cafe in my_favorite_cafes %}
          <!-- ê° ì¹´í˜ë¥¼ swiper-slideë¡œ ê°ìŒˆ -->
          <div class="swiper-slide">
            <div class="h-full" data-cafe-id="{{ cafe.id }}">
              {% include 'ddoksang/components/_cafe_card.html' with cafe=cafe show_favorite_btn=True user_favorites=user_favorites show_status_badge=True show_type_badge=True show_benefits=True %}
            </div>
          </div>
        {% endfor %}
      </div>

      <!-- ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ -->
      <div class="swiper-button-next favorites-next"></div>
      <div class="swiper-button-prev favorites-prev"></div>
      
      <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
      <div class="swiper-pagination favorites-pagination"></div>
    </div>

    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    
    <!-- Swiper ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // ê¸°ì¡´ Swiper ì¸ìŠ¤í„´ìŠ¤ê°€ ìˆë‹¤ë©´ ì œê±°
        if (window.favoritesSwiper) {
            window.favoritesSwiper.destroy(true, true);
        }

        // Swiper ì´ˆê¸°í™”
        window.favoritesSwiper = new Swiper('.favorites-swiper', {
            // ê¸°ë³¸ ì„¤ì •
            slidesPerView: 1,
            spaceBetween: 20,
            loop: false,
            
            // ë°˜ì‘í˜• ë¸Œë ˆì´í¬í¬ì¸íŠ¸
            breakpoints: {
                640: {
                    slidesPerView: 2,
                    spaceBetween: 20,
                },
                768: {
                    slidesPerView: 2,
                    spaceBetween: 24,
                },
                1024: {
                    slidesPerView: 3,
                    spaceBetween: 24,
                },
                1280: {
                    slidesPerView: 4,
                    spaceBetween: 24,
                },
            },
            
            // ë„¤ë¹„ê²Œì´ì…˜
            navigation: {
                nextEl: '.favorites-next',
                prevEl: '.favorites-prev',
            },
            
            // í˜ì´ì§€ë„¤ì´ì…˜
            pagination: {
                el: '.favorites-pagination',
                clickable: true,
                dynamicBullets: true,
            },
            
            // ì ‘ê·¼ì„±
            a11y: {
                prevSlideMessage: 'ì´ì „ ì°œí•œ ì¹´í˜',
                nextSlideMessage: 'ë‹¤ìŒ ì°œí•œ ì¹´í˜',
            },
            
            // í‚¤ë³´ë“œ ì œì–´
            keyboard: {
                enabled: true,
            },
            
            // ë§ˆìš°ìŠ¤ íœ 
            mousewheel: {
                forceToAxis: true,
            },
            
            // ìë™ ë†’ì´ ì¡°ì •
            autoHeight: false,
            
            // ìŠ¬ë¼ì´ë“œ ì‹œì‘/ëì—ì„œ íš¨ê³¼
            resistance: true,
            resistanceRatio: 0.85,
            
            // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
            effect: 'slide',
            speed: 400,
            
            // í„°ì¹˜ ì„¤ì •
            touchRatio: 1,
            touchAngle: 45,
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            on: {
                init: function() {
                    console.log('ì°œí•œ ì¹´í˜ Swiper ì´ˆê¸°í™” ì™„ë£Œ');
                },
            }
        });

        // ì¹´ë“œ ë†’ì´ ê· ë“±í™”
        function equalizeCardHeights() {
            const slides = document.querySelectorAll('.favorites-swiper .swiper-slide');
            let maxHeight = 0;
            
            slides.forEach(slide => {
                slide.style.height = 'auto';
            });
            
            slides.forEach(slide => {
                maxHeight = Math.max(maxHeight, slide.offsetHeight);
            });
            
            slides.forEach(slide => {
                slide.style.height = maxHeight + 'px';
            });
        }

        setTimeout(equalizeCardHeights, 100);
        window.addEventListener('resize', equalizeCardHeights);
    });
    </script>

    <!-- Swiper ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ -->
    <style>
    .favorites-swiper {
        padding: 0 40px 50px 40px;
        margin: 0 -20px;
    }

    .favorites-swiper .swiper-slide {
        height: auto;
        display: flex;
        flex-direction: column;
    }

    .favorites-swiper .swiper-slide > div {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .favorites-next,
    .favorites-prev {
        width: 32px !important;
        height: 32px !important;
        margin-top: -16px !important;
        background: white !important;
        border: 2px solid #e5e7eb !important;
        border-radius: 50% !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
        color: #374151 !important;
        transition: all 0.2s ease !important;
    }

    .favorites-next:hover,
    .favorites-prev:hover {
        background: #f9fafb !important;
        border-color: #d1d5db !important;
        transform: scale(1.1) !important;
    }

    .favorites-next.swiper-button-disabled,
    .favorites-prev.swiper-button-disabled {
        opacity: 0.3 !important;
        cursor: not-allowed !important;
    }

    .favorites-next::after,
    .favorites-prev::after {
        font-size: 12px !important;
        font-weight: bold !important;
    }

    .favorites-pagination {
        bottom: 10px !important;
        text-align: center !important;
    }

    .favorites-pagination .swiper-pagination-bullet {
        width: 8px !important;
        height: 8px !important;
        background: #d1d5db !important;
        opacity: 1 !important;
        margin: 0 4px !important;
    }

    .favorites-pagination .swiper-pagination-bullet-active {
        background: #ec4899 !important;
        transform: scale(1.2) !important;
    }

    @media (max-width: 640px) {
        .favorites-next,
        .favorites-prev {
            display: none !important;
        }
        
        .favorites-swiper {
            padding: 0 20px 40px 20px;
        }
    }

    .favorites-swiper .swiper-slide:hover {
        transform: translateY(-2px);
        transition: transform 0.2s ease;
    }
    </style>

  {% else %}
    <!-- ë¹ˆ ìƒíƒœ -->
    <div class="text-center py-16">
      <div class="text-6xl mb-4">ğŸ’”</div>
      <h3 class="text-lg font-medium text-gray-900 mb-2">ì•„ì§ ì°œí•œ ìƒì¼ì¹´í˜ê°€ ì—†ì–´ìš”</h3>
      <p class="text-gray-600 mb-6">ë§ˆìŒì— ë“œëŠ” ìƒì¹´ë¥¼ ì°œí•´ë³´ì„¸ìš”!</p>
      <a href="{% url 'ddoksang:home' %}" class="inline-block bg-pink-600 text-white px-6 py-3 rounded-lg hover:bg-pink-700 transition-colors">
        ìƒì¼ì¹´í˜ ë‘˜ëŸ¬ë³´ê¸°
      </a>
    </div>
  {% endif %}
</section>